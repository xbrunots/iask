(window.webpackJsonp=window.webpackJsonp||[]).push([["desktop-feed-edgenext-wc"],{"2H+z":function(e,t,i){"use strict";var a=i("yvDU"),n=i("rkDk"),s=i("wh7w"),r=i("btVS"),o=i("SEb4");t.a=function(e,t,i){var c=Object(o.a)(e)?a.a:r.a,d=arguments.length<3;return c(e,Object(s.a)(t,4),i,d,n.a)}},"7oW3":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var a=i("G82u");class n{}function s(){n.updateLocationDisplayName.unregisterObservers(),n.fetchWeatherSummarySuccess.unregisterObservers(),n.fetchWeatherSummaryFailure.unregisterObservers(),n.patchHourlyForecastSuccess.unregisterObservers(),n.updateLocationDetectionState.unregisterObservers(),n.updateWeatherUserProfile.unregisterObservers(),n.updateCurrentLocation.unregisterObservers(),n.updateWeatherSettings.unregisterObservers(),n.updateNonmapComponmentsReadiness.unregisterObservers(),n.updateOperationFailure.unregisterObservers(),n.updateFallbackStatus.unregisterObservers(),n.updateHyperlocal.unregisterObservers(),n.openEditLocation.unregisterObservers()}n.updateLocationDisplayName=new a.a("UpdateLocationDisplayName"),n.fetchWeatherSummarySuccess=new a.a("FetchWeatherSummarySuccess"),n.fetchWeatherSummaryFailure=new a.a("FetchWeatherSummaryFailure"),n.patchHourlyForecastSuccess=new a.a("FetchHourlyForecastSuccess"),n.updateLocationDetectionState=new a.a("UpdateLocationDetectionState"),n.updateWeatherUserProfile=new a.a("UpdateWeatherUserProfile"),n.updateCurrentLocation=new a.a("UpdateCurrentLocation"),n.updateWeatherSettings=new a.a("UpdateWeatherSettings"),n.updateNonmapComponmentsReadiness=new a.a("UpdateNonmapComponmentsReadiness"),n.updateOperationFailure=new a.a("updateOperationFailure"),n.updateFallbackStatus=new a.a("updateFallbackStatus"),n.updateHyperlocal=new a.a("updateHyperlocal"),n.openEditLocation=new a.a("editLocationName")},"7qs3":function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var a,n=i("D57K"),s=i("h3hC"),r=i("ypwz"),o=i("tERu"),c=i("HxRh"),d=i("XlyT"),l=i("rvYQ"),h=i("I6Lx"),u=i("u5KZ"),p=i("6ADy"),g=i("msIb"),v=i("KETb"),b=i("k112"),m=i("KUTD"),f=i("Qo3E"),O=i("8ntK");!function(e){e[e.feedbackDefault=2224]="feedbackDefault",e[e.windowsFeed=2475]="windowsFeed"}(a||(a={}));class C{constructor(){this.manifestType="Sas",this.appId=a.feedbackDefault,this.source="Client",this.type="Idea"}}var S=i("HDSB"),y=i("4L2h"),j=i("r6MD"),A=i("/+Un"),w=i("ac9z");class I extends class{constructor(e,t){this.fetchImpl=e,this.additionalHeaders=t,this.isWindowsDashboard=l.a.AppType===r.a.NewsAndInterests||l.a.AppType===r.a.WindowsNewsPlus,this.providersServiceEndpointURL=Object(p.c)("./Msn/Providers"),this.cardActionsServiceEndpointURL=Object(p.c)("./Graph/Actions"),this.userFeedbackEventhubUrl="/labs/api/feedbackSignal",this.ocid="feeds",this.isWindowsDashboard?this.ocid="winp2":h.b.IsBlendedEnterprise&&(this.ocid="entnewsntp")}ShowFewer(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.PostCardActionRequest(e,s.a.Dislike,null)}))}UnshowFewer(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.DeleteCardActionRequest(e,s.a.Dislike)}))}ShowMore(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.PostCardActionRequest(e,s.a.Like)}))}UnshowMore(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.DeleteCardActionRequest(e,s.a.Like)}))}Save(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.PostCardActionRequest(e,s.a.Save)}))}Unsave(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.DeleteCardActionRequest(e,s.a.Save)}))}Hide(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.PostCardActionRequest(e,s.a.Dislike,null)}))}Unhide(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.DeleteCardActionRequest(e,s.a.Dislike)}))}Mute(e){return Object(n.a)(this,void 0,void 0,(function*(){return this.PostCardActionRequest(e,s.a.Mute,"SourceProvider")}))}Report(e,t,i){return Object(n.a)(this,void 0,void 0,(function*(){const a=h.b.ClientSettings?h.b.ClientSettings.aid:"";let n="";const s={serviceType:"oneservice",oneServiceTraceId:"",oneServiceActivityId:a};l.a.AppType===r.a.Windows&&(n=u.a.getPageMetadata().JoinIdProps.IDXId,s.oneServiceTraceId="",s.oneServiceActivityId=a),u.a.sendTraceInfoEvent(s);const o=JSON.stringify({article:{id:e},canvas:{name:l.a.AppType,version:navigator.userAgent,pageType:h.b.ClientSettings.pagetype},data:{activityId:a,feedbackTags:t,feedbackText:i},appEnvironment:l.a,clientSettings:h.b.ClientSettings,extSchema:s}),d=Object(p.b)().origin+this.userFeedbackEventhubUrl,v={method:"POST",headers:Object.assign(Object.assign({},yield g.a.getOneServiceHeaders()),this.additionalHeaders),body:o,credentials:"include"};let b;try{if(b=yield fetch(d,v),b.status>=400)throw new Error(b.statusText)}catch(e){u.a.sendAppErrorEvent(Object.assign(Object.assign({},c.ab.CardActionPostActionError),{message:"Error while posting action for card action",pb:Object.assign(Object.assign({},c.ab.CardActionPostActionError.pb),{customMessage:`url: ${d}, error: ${e}`})}))}return b}))}reportNonCMS(e,t,i,a){return Object(n.a)(this,void 0,void 0,(function*(){this.ReportOCV(e,t,i,a)}))}ReportOCV(e,t,i,a){return Object(n.a)(this,void 0,void 0,(function*(){let n=!1;const s="https://petrol.office.microsoft.com/v1/feedback",r=this.createOcvFeedbackData(e,t,i,a),o={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{const e=yield this.fetchImpl(s,o);if(e.ok)n=!0;else{const t=`Error code: ${e.status} Error message: ${e.statusText} Request params: ${o} Service url: ${s}`;Object(d.b)(c.ab.CardActionBadRequestReportingToOcv,"Request is not valid, it has no content, or the manifest is not formatted correctly",t)}}catch(e){const t=`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"} Request params: ${o} Service url: ${s}`;Object(d.c)(e,c.ab.CardActionExceptionReportingToOcv,"Exception reporting feedback to OCV",t)}}))}createOcvFeedbackData(e,t,i,a){var n,s,r,o;const c=new C,d=null===h.b||void 0===h.b?void 0:h.b.ClientSettings,p=null===l.a||void 0===l.a?void 0:l.a.HostPage,g=(null==d?void 0:d.aid)||"";let v="";const b=(null===(s=null===(n=null===l.a||void 0===l.a?void 0:l.a.CurrentRequestTargetScope)||void 0===n?void 0:n.pageExperiments)||void 0===s?void 0:s.join(","))||"",m=null===(r=null===l.a||void 0===l.a?void 0:l.a.CurrentRequestTargetScope)||void 0===r?void 0:r.browser;return v=u.a.getPageMetadata().JoinIdProps.IDXId,c.submitTime=(new Date).toISOString(),c.clientFeedbackId=Object(y.e)(),c.comment=i,c.rating=4,c.application={appData:`{"ScreenResolution":"${window&&window.screen?[screen.width,screen.height].join("x"):""}","DDDActivityId":"${v}","articleId":"${e}"}`},c.telemetry={audience:(null===l.a||void 0===l.a?void 0:l.a.CurrentMarket)||"",audienceGroup:(null==p?void 0:p.verticalKey)||"Production",channel:(null==p?void 0:p.categoryKey)||"",deviceType:(null==d?void 0:d.deviceFormFactor)||"",errorClassification:JSON.stringify({NotRelevant:t.NotRelevant,ImageQuality:t.BlurryImage,MisleadingTitle:t.Misleading,OutdatedArticle:t.Outdated,DuplicateArticle:t.Duplicate,OffensiveContent:t.Offensive,Vertical:a}),featureArea:(null==d?void 0:d.pagetype)||"",flights:b,isUserSubscriber:Object(A.e)(),platform:null===(o=l.a.CurrentRequestTargetScope)||void 0===o?void 0:o.os,processSessionId:g,sourceContext:l.a.AppType},c.web={browser:(null==m?void 0:m.browserType)||"",browserVersion:(null==m?void 0:m.version)||"",sourcePageName:(null==p?void 0:p.subcategoryKey)||"",sourcePageURI:""},c}ReportAd(e,t){return Object(n.a)(this,void 0,void 0,(function*(){const i=e.concat("&f="+t);let a=new Image(1,1);a.src=i,a=null}))}GetProviderIcon(e){return Object(n.a)(this,void 0,void 0,(function*(){const t=yield this.GetPublisherDetails(e);return Object(j.a)(t,"value[0].logos[0].imageLink.href",void 0)}))}PostCardActionEvent(e,t,i,a=(()=>null),r,o,c=!0,d,l=5e3){return Object(n.a)(this,void 0,void 0,(function*(){switch(t){case s.a.ShowMore:return e&s.b.showMore?(c&&f.a.renderToast({id:O.a.ShowMore+"-"+i,toastType:O.a.ShowMore,expirationInMs:l,onClick:()=>{r?r(i,e^s.b.showMore,t,!0):this.PostCardActionEvent(e^s.b.showMore,t,i,a)},referrerButton:d}),yield this.ShowMore(i)):(f.a.expireToast(O.a.ShowMore+"-"+i),yield this.UnshowMore(i)),a(i,e);case s.a.ShowFewer:return e&s.b.showFewer?(c&&f.a.renderToast({id:O.a.ShowFewer+"-"+i,toastType:O.a.ShowFewer,expirationInMs:l,onClick:()=>{r?r(i,e^s.b.showFewer,t,!0):this.PostCardActionEvent(e^s.b.showFewer,t,i,a)},referrerButton:d}),yield this.ShowFewer(i)):(f.a.expireToast(O.a.ShowFewer+"-"+i),yield this.UnshowFewer(i)),a(i,e);case s.a.Save:return e&s.b.saved?(c&&f.a.renderToast({id:O.a.Save+"-"+i,toastType:O.a.Save,expirationInMs:l,referrerButton:d}),yield this.Save(i)):(f.a.expireToast(O.a.Save+"-"+i),yield this.Unsave(i)),a(i,e);case s.a.Hide:return e&s.b.hide?yield this.Hide(i):yield this.Unhide(i),a(i,e);case s.a.Mute:yield this.Mute(o);break;case s.a.ReportAd:return a(i,e);default:return}}))}GetPublisherDetails(e){return Object(n.a)(this,void 0,void 0,(function*(){const t=this.providersServiceEndpointURL,i={method:"GET",headers:Object.assign(Object.assign({},yield g.a.getOneServiceHeaders()),this.additionalHeaders)};[{key:"ids",value:e},...yield this.getOneServiceCommonParam()].forEach(e=>e.value&&t.searchParams.set(e.key,e.value));try{const a=yield Object(v.b)(()=>Object(n.a)(this,void 0,void 0,(function*(){return yield this.fetchImpl(t.href,i)})),"getProviderDetails");if(!a.ok){const i=`OneService returned error response. Status: ${a.status} for providerId: ${e} (url: ${t.href}`;throw new Error(i)}return a.json()}catch(e){u.a.sendAppErrorEvent(Object.assign(Object.assign({},c.ab.CardActionGetActionError),{message:`Error while calling getPublisherDetails action for card action: url: ${t.href}, error: ${e}`}))}}))}DeleteCardActionRequest(e,t){return Object(n.a)(this,void 0,void 0,(function*(){const i=this.cardActionsServiceEndpointURL,a={method:"DELETE",credentials:"include",headers:Object.assign(Object.assign({},yield g.a.getOneServiceHeaders()),this.additionalHeaders)};[{key:"$filter",value:`actionType eq '${t}' and targetId eq '${e}'`},...yield this.getOneServiceCommonParam()].forEach(e=>e.value&&i.searchParams.set(e.key,e.value));try{const s=yield Object(v.b)(()=>Object(n.a)(this,void 0,void 0,(function*(){return yield this.fetchImpl(i.href,a)})),"deleteCardAction"+t);if(s.status>=400){const i=`OneService returned error response. Status: ${s.status} for actionType: ${t} and targetId: ${e}`;throw new Error(i)}return Object(b.a)(this.getPreloadReloadReason(t)),Object(w.e)(),s}catch(e){u.a.sendAppErrorEvent(Object.assign(Object.assign({},c.ab.CardActionDeleteActionError),{message:`Error while calling delete action for card action: url: ${i.href}, error: ${e}`}))}}))}PostCardActionRequest(e,t,i){return Object(n.a)(this,void 0,void 0,(function*(){const a=this.cardActionsServiceEndpointURL,s={method:"POST",body:JSON.stringify({actionType:t,targetId:e,targetType:i}),headers:Object.assign(Object.assign({},yield g.a.getOneServiceHeaders()),this.additionalHeaders),credentials:"include"};(yield this.getOneServiceCommonParam()).forEach(e=>e.value&&a.searchParams.set(e.key,e.value));try{const r=yield Object(v.b)(()=>Object(n.a)(this,void 0,void 0,(function*(){return yield this.fetchImpl(a.href,s)})),"getCardAction"+t);if(r.status>=400){const a=`OneService returned error response. Status: ${r.status} for actionType: ${t}, targetId: ${e} and targetType: ${i}`;throw new Error(a)}return Object(b.a)(this.getPreloadReloadReason(t)),Object(w.e)(),r.json()}catch(e){u.a.sendAppErrorEvent(Object.assign(Object.assign({},c.ab.CardActionPostActionError),{message:`Error while posting action for card action: url: ${a.href}, error: ${e}`}))}}))}getOneServiceCommonParam(){return Object(n.a)(this,void 0,void 0,(function*(){return this.isWindowsDashboard?g.a.getOneServiceParamsWithoutAuth(l.a.UserId,this.ocid,!1):(yield this.isUserSignedIn())?g.a.getOneServiceParamsWithAuth(l.a.UserId,this.ocid,!h.b.IsBlendedEnterprise):g.a.getOneServiceParamsWithoutAuth(l.a.UserId,this.ocid,!h.b.IsBlendedEnterprise)}))}isUserSignedIn(){return Object(n.a)(this,void 0,void 0,(function*(){if(h.b.UserIsSignedIn)return!0;return(yield Object(A.d)())===o.c.SignedIn}))}getPreloadReloadReason(e){switch(e){case s.a.Mute:return m.a.MutePublisher;case s.a.Save:return m.a.Save;case s.a.Like:return m.a.Like;case s.a.Dislike:return m.a.Dislike;default:return m.a.SettingsChange}}}{constructor(e,t){let i;i=e||(Object(S.a)()?window.fetch.bind(window):fetch),super(i,t)}}let T;const R=(e,t)=>T||(T=new I(e,t),T)},"8ntK":function(e,t,i){"use strict";var a;i.d(t,"a",(function(){return a})),function(e){e.Save="Save",e.Mute="Mute",e.Follow="Follow",e.Unfollow="Unfollow",e.InterestFailure="InterestFailure",e.ShowMore="ShowMore",e.ShowFewer="ShowFewer",e.Hide="Hide",e.DisableNotification="DisableNotification",e.EnableNotification="EnableNotification"}(a||(a={}))},AMBy:function(e,t,i){"use strict";function a(e,t){return"function"==typeof IntersectionObserver?new IntersectionObserver(e,t):null}i.d(t,"a",(function(){return a}))},Cj5D:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return d}));var a,n,s=i("C4R5"),r=i("HS3Q"),o=i("+qLX"),c=i("w0HK");function d(e,t){e&&t?Object(s.a)().pushHistory(r.a.Personalize,"",{isRequestFromSdCardAddRemoveClick:!0}):e&&Object(c.a)().switchPivot({pivotId:e.pivotId,configIndexHref:e.configIndexHref,configIndexRef:e.configIndexRef,context:Object.assign(Object.assign({},e.context),{isRequestFromSdCardAddRemoveClick:!0}),telemetryPageName:o.a.Interests,display:e.displayName})}!function(e){e.SwitchToPageSettings="SwitchToPageSettings",e.SwitchToNewsSettingsInPersonalizePivot="SwitchToNewsSettingsInPersonalizePivot"}(a||(a={})),function(e){e.edgePageSettings="EdgePageSettings",e.chromiumPageSettings="ChromiumPageSettings",e.proActiveCanvasSettingHandler="ProActiveCanvasHandler",e.localStorageSettings="LocalStorageSettings"}(n||(n={}))},JFdr:function(e,t,i){"use strict";var a=Math.floor,n=Math.random;t.a=function(e,t){return e+a(n()*(t-e+1))}},KPQt:function(e,t,i){"use strict";var a=i("XAMW"),n=i("b8Mt"),s=i("wh7w");t.a=function(e,t){return Object(a.a)(e,Object(s.a)(t,3),n.a)}},Qo3E:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i("u5KZ"),n=i("XlyT"),s=i("HxRh");class r{static renderToast(e){this.renderToastCallback?this.renderToastCallback(e):a.a.sendAppErrorEvent(Object(n.a)(s.Gh,"Undefined toast render callback function"))}static setRenderToastCallback(e){this.renderToastCallback=e}static expireToast(e){this.expireToastCallback?this.expireToastCallback(e):a.a.sendAppErrorEvent(Object(n.a)(s.Fh,"Undefined toast expire callback function"))}static setExpireToastCallback(e){this.expireToastCallback=e}static setCurrentToast(e,t){this.currentToastId!==e&&(this.currentToastId=e,this.renderToastCallback=t,this.currentToastIdChangeCallbacks.forEach(t=>t(e)),this.renderToast())}static addCurrentToastIdChangeCallback(e){e&&this.currentToastIdChangeCallbacks.push(e)}}r.currentToastIdChangeCallbacks=[]},RAp8:function(e,t,i){"use strict";i.r(t),i.d(t,"ToolingInfo",(function(){return ai})),i.d(t,"RenderFeedType",(function(){return mt})),i.d(t,"SDCardMenuOperation",(function(){return Ht})),i.d(t,"DesktopFeedEdgeNextWC",(function(){return qt})),i.d(t,"LegacyPrefetchBehavior",(function(){return te})),i.d(t,"ColdStartDisplayType",(function(){return ie})),i.d(t,"DesktopFeedEdgeNextWCTemplate",(function(){return ei})),i.d(t,"DesktopFeedEdgeNextWCStyles",(function(){return ii}));var a=i("C49W"),n=i("sydv"),s=i("nkry"),r=i("tZnx"),o=i("A03o"),c=i("akWC"),d=i("Zn5T");const l=Object(a.b)("filterDomain","Domain list which should be filtered","",Object.assign({},Object(n.b)("domain","domain should be filtered"))),h=Object(a.f)("motionThumbConfig","Config for motion thumbnail","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(a.c)("EnableCaption","Enable Caption")),Object(a.c)("EnableMuteControl","Enable Mute Control")),Object(a.c)("EnablePlayingContext","Enable Playing Context")),Object(a.c)("EnableProgressBar","Enable ProgressBar")),Object(a.c)("EnableVolumeControl","Enable Volume Control")),Object(a.d)("ProgressBarPadding","ProgressBar Padding"))),u=Object(a.f)("pivotSelectionInfo","Info for pivot switch","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(n.c)("pivotId","The ID of the pivot")),Object(n.c)("configIndexHref","The config index href")),Object(n.c)("telemetryPageName","The pagename of this pivot to be used for telemetry purposes")),Object(n.c)("telemetryPivotCategory","The category of this pivot")),Object(n.c)("display","The display string")),Object(n.c)("branding","The custom branding")),Object(a.f)("baseDynamicTargetUrl","the base external url for dynamic query operation","",Object.assign(Object.assign({},Object(n.c)("href","Link address to the new page")),Object(a.c)("openInNewTab","flag to determine if the link opens in new tab"))))),p=Object(a.f)("CarouselType","Carousel type","",Object.assign(Object.assign({},Object(n.c)("InfoPane","based on InfoPane")),Object(n.c)("HorizontalSlider","based on MsftHorizontalSlider"))),g=Object(a.f)("DataMapperType","DataMapperType","",Object.assign(Object.assign({},Object(n.c)("Reco","data schema is VideoCardInfo")),Object(n.c)("OneService","data schema is OneService"))),v=Object(a.f)("NavigateDestination","NavigateDestination","",Object.assign(Object.assign(Object.assign(Object.assign({},Object(n.c)("VDP","navigate to bing video detail page")),Object(n.c)("Overlay","show a overlay iFrame player")),Object(n.c)("Original","go to original site")),Object(n.c)("Watch","navigate to Watch experience"))),b=Object(a.f)("BingMotionThumbPreviewType","Motion thumb preview type","",Object.assign(Object.assign({},Object(n.c)("Auto","autoplay")),Object(n.c)("Hover","play the motion thumb when hover"))),m=Object(a.f)("BingVideoCardStyleType","Slide bing video card style","",Object.assign(Object.assign({},Object(n.c)("Append","below the static-thumb")),Object(n.c)("Cover","cover on static-thumb"))),f=Object(a.f)("adTemplateConfig","Ad template configuration","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(s.b)("allowedAssets","a list of IDs allowed decoration assets","",[Object(a.a)("array"),Object(r.a)()])),Object(a.c)("immersiveThemeColor","whether enable theme color for immersive")),Object(a.d)("discountThreshold","threshold to show discount")),Object(n.c)("templateType","type of template for an ad card to use")),Object(a.c)("adCarousel","whether multi ad carousel style is turned on")),Object(n.c)("animatedImage","image animation type: scale-up/scale-down/scale-up-down")),Object(a.c)("progressiveDisplay","whether progressive decoration is turned on")),Object(a.c)("templateSelection","whether client side template selection logic is enabled")),Object(a.c)("flipZIndex","whether image is on top or bottom for z-index template, true: top; false: bottom")),Object(a.c)("isProviderNameClickable","is provider name clickable")),Object(a.f)("animatedConfig","animation config properties","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(a.d)("delayTimeMs","animation parameter - delayTimeMs")),Object(a.d)("duration","animation parameter - duration")),Object(n.c)("durationString","animation parameter - durationString")),Object(n.c)("scaleFrom","animation parameter - scaleFrom")),Object(n.c)("scaleTo","animation parameter - scaleTo")))),Object(a.f)("slideshowProps","slide show properties","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(a.c)("autoScroll","whether images are automatically scrolled on start")),Object(a.d)("psuedoVideoAllocation","whether pseudo video is enabled side by side with slideshow")),Object(a.d)("psuedoVideoScrollInterval","interval to move to next image")),Object(a.d)("slideshowScrollInterval","interval to move to next image")),Object(a.d)("maxImageCount","maximum image supported by slideshow")))),Object(a.f)("imageSizeConfig","auction call image size properties","",Object.assign(Object.assign({},Object(a.f)("infopane","image size for infopane section","",Object.assign(Object.assign({},Object(a.d)("w","width for infopane image")),Object(a.d)("h","height for infopane image")))),Object(a.f)("river","image size for river section","",Object.assign(Object.assign({},Object(a.d)("w","width for river image")),Object(a.d)("h","height for river image"))))))),O=Object(a.f)("bingVideoCardConfig","config for bing video carousel","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(n.c)("bingVideoDetailPageFormat","Bing video detail page src format")),Object(n.c)("bingVideoOverlayPlayerHeight","Bing video overlay player height")),Object(n.c)("bingVideoOverlayPlayerWidth","Bing video overlay player width")),Object(n.c)("bingVideoPlayerSrcFormat","Bing video player src format for iframe")),Object(a.c)("carouselAutoRotate","Enable/disable auto-rotate feature")),Object(a.d)("carouselRotationInterval","Carousel auto-rotate interval")),p),Object(a.c)("checkBingEmbed","Check embeddable in bing or not")),g),l),Object(n.c)("headerSeeAllDestinationUrl","See all of header destination url")),Object(n.c)("headerTitleDestinationUrl","Title of header destination url")),Object(n.c)("horizontaItemHeight","Hight for the horizontal item")),Object(n.c)("horizontaItemWidth","Width for the horizontal item")),v),h),u),Object(n.c)("opalRecoFeedbackUrl","Feedback url for opal reco personalization")),b),Object(n.c)("seeMoreDestinationUrl","Seemore button destination url")),m)),C=Object(a.f)("trendingNewsConfig","config for trending now","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(n.c)("contentId","Content id for trending now")),Object(a.d)("numberOfTermsToDisplay","Number of trending now terms to display")),Object(n.c)("ocid","Ocid override to use for oneservice call")),Object(a.d)("timeoutMs","Timeout in ms for oneservice call")),Object(n.c)("oneServiceId","One service interest id for trending now")),Object(n.c)("headingLink","Key to indicate link for the trending now card")),Object(a.d)("headlineLineLength","Key to indicate maximum length for headlines")),Object(a.f)("gradientBackground","radient background treatment for serendipity card","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(n.c)("darkBackgroundColor","background color for card in dark mode")),Object(n.c)("lightBackgroundColor","background color for card in light mode")),Object(n.c)("darkTitleColor","trending and recommended title color in dark mode")),Object(n.c)("lightTitleColor","trending and recommended title color in light mode")),Object(n.c)("titleFontSize","trending and recommended title font size"))))),S=Object(a.f)("sportsCardConfig","config for sports card","",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(a.c)("enableHideCard","Enable hide card menu")),Object(a.b)("sportsSegments","Market segment map","",Object(a.e)("sports segment","sports segment",Object.assign(Object.assign(Object.assign({},Object(n.c)("market","market")),Object(n.c)("sportsVertical","sports vertical")),Object(n.c)("leagueSegment","league segment"))))),Object(a.b)("disableMatchClickThroughBySport","Click disabled match list","",Object(n.b)("disable matchClick throughBy Sport",""))),Object(a.c)("disableCardAction","Disable the card action button")),Object(a.c)("enableGradientBackground","Enable gradient background"))),y=Object(o.a)(d.a.desktopFeedEdgeNextWC,"Edge next desktop feed",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(c.a)({followText:"Follow",followingText:"Following",seeMoreMoney:"See more",moneyCardMarketTitle:"MONEY | MARKET",moneyCardWatchlistTitle:"MONEY | WATCHLIST",moneyCardAddSymbolTitle:"< MONEY | ADD SYMBOLS",addSymbolOptStr:"Add symbols",signinOptStr:"Sign in to see your watchlist",hideCardOptStr:"Hide money card",dataProviderOptStr:"Data provider",moreSettingOptStr:"More settings",addSymbolBtnStr:"+ Add Symbols",emptyWatchlistStr:"Your list is empty.",quoteItemToolTip:"Click to see more information",moneyCardSuggestedQuotesTitle:"Suggested For You",cancelText:"Cancel",seeMoreSports:"See more {0}",sportsStateFinal:"Final",sportsTBA:"TBA",trafficHeading:"TRAFFIC",viewMapText:"View map",menuHideTrafficCard:"Hide traffic card",fasterThanUsual:"Faster Than Usual",noTraffic:"No Traffic",moderateTraffic:"Moderate Traffic",heavyTraffic:"Heavy Traffic",topPicksHeadingText:"Top Picks for You",JustNow:"just now",NumberDayAgo:"{0}d ago",NumberDaysAgo:"{0}d ago",NumberHourAgo:"{0}h ago",NumberHoursAgo:"{0}h ago",NumberMinuteAgo:"{0}m ago",NumberMinutesAgo:"{0}m ago",TimeYesterday:"yesterday at {0}",hideStoryTitle:"Got it! We won't show you this story in the future",undoHideButtonText:"Undo",personalizeButtonText:"Personalize my feed",shoppingHeading:"Today's Deal",trafficMapAltText:"Traffic Map",nativeAdShopNowText:"Shop now",nativeAdCurbsidePickupText:"Curbside pickup",nativeAdOnSaleText:"{0}% off",nativeAdPriceDropText:"Price drop",nativeAdInStoreText:"In Store",nativeAdNewProductText:"New",nativeAdFreeShippingText:"Free Shipping",nativeAdInstallmentPriceFormatNow:"{0} now",nativeAdInstallmentPriceFormatPlan:"{0}/mo x {1}",nativeAdPriceDropShortText:"{0}% price drop",nativeAdPriceDropLongText:"Price dropped {0}% below its {1} days average",nativeAdTopViewedShortText:"{0}+ viewed",nativeAdTopViewedLongText:"More than {0} people from Bing viewed this product in the last {1} days",nativeAdReplayVideoText:"Replay video",nativeAdViewDetailsText:"View details",nativeAdViewDiscountText:"View discount",nativeAdGuessPriceText:"Guess the Price",nativeAdCorrectText:"Correct!",nativeAdGuessAgainText:"Guess again!",videoAdLearnMoreText:"Learn more",cardActionsTooltips:{undoShowMore:"undo",showMore:"showMore",hide:"hide",undoShowFewer:"undo",showFewer:"showFewer",save:"save",seeMore:"seeMore",undoSave:"undo"},moneyCardTabs:{watchlist:{title:"Watchlist",seeMore:"See Watchlist"},market:{title:"Market",seeMore:"See Market"},recent:{title:"Recent",seeMore:"See Recent"},currencies:{title:"Currencies",seeMore:"See Currencies"},movers:{title:"Movers",seeMore:"See Movers"},gainers:{title:"Gainers",seeMore:"See Gainers"},losers:{title:"Losers",seeMore:"See Losers"}},moneyCardHeaderTitle:"Money",reportAdDialogRepeatedAdText:"Seen this ad multiple times",reportAdDialogInappropriateAdText:"Ad was inappropriate",reportAdDialogNotInterestedText:"Not interested in this ad",reportAdDialogMisleadingAdText:"Misleading ad or spam",cardActionMenuItemReport:"Report an issue",reportDialogSaveButtonText:"Submit",reportDialogConfirmationText:"Thank you for your feedback!",bingVideoHeaderSeeAll:"See all",bingVideoHeaderTitle:"Trending Videos for you",bingVideoNoPreviewStr:"No Preview",bingVideoPreviewStr:"Preview",bingVideoTag:"Videos",bingVideoViews:"{0} views",seeMoreVideos:"See more videos",infoPanePreviousFlipperTitle:"Previous slide",infoPaneNextFlipperTitle:"Next slide"})),Object(a.d)("expectedColdStartPosition","")),Object(a.c)("upsellLaunchesInline","")),Object(a.c)("scrollDownTopSiteInf","In Informational layout, scroll down page to hide top site if top site is collapsed.")),Object(a.c)("invertSlugPosition","Flag to define if slug position needs to be inverted with the ad text")),Object(a.c)("isRightBottomAdsBingIcon","Flag to define if ads bing icon needs to be fixed in right bottom when ads icon is on top of text content")),Object(a.c)("isNewPrefetchlogic","using new prefetch logic or not")),Object(a.d)("numOfSectionsToPrefetch","num of un-rendered sections left to prefetch feed data")),O),f),C),S),Object(a.c)("enableWillChange","EnableWillChange")),Object(a.c)("enableContentTypeIndications","EnableContentTypeIndications")),Object(a.c)("miniMediaIndicatorsIcons","Smaller media indicators icons")),Object(a.c)("showColorfulHalfUContentCard","show colorful 0.5u card or not")),Object(a.c)("useColorfulInfopane","Use Colorful Infopane Content Cards")),Object(a.c)("isInfopaneImage43","isInfopaneImage43")),Object(a.c)("isInfopaneImage1610","isInfopaneImage1610")),Object(a.c)("isImage43","isImage43")),Object(a.c)("isImage1610","isImage1610")),Object(a.d)("infopaneTitleFontSize","infopaneTitleFontSize")),Object(a.c)("enableVerticalGradientInfopaneCard","enableVerticalGradientInfopaneCard")),Object(a.d)("infopaneHeadingLineHeight","infopaneHeadingLineHeight")),Object(a.d)("headingLineHeight","headingLineHeight")),Object(a.d)("cardActionBitMask","Card actions inline features bitmask")),Object(a.c)("enableHideStoryFeedback","Enables the hide story feedback card")),Object(a.c)("openPersonalizeWithoutRouter","Whether to avoid using the peregrine router when going to Personalize page; instead, when true, will use PivotManager when available")),Object(a.c)("enableGreyBlock","Enable grey block skeleton")),Object(a.c)("isBlurred","Flag indicates image is blurred")),Object(a.c)("enableAuctionInWebWorker","Flag to indicate whether we enabled auction call in web worker")),Object(a.c)("enableAdsColorBleed","Enable ads color bleed")),Object(a.c)("enableCMSAdsInWebWorker","Flag to indicate whether we enabled cms ads call in web worker")),Object(a.c)("noCardFiltering","Flag to avoid filtering SD cards")),Object(n.c)("contentTTVR","ContentTTVR","Type of Content Wait for TTVR",["infoPane","2rows","full"],"infoPane")),Object(a.c)("enableScrollMetrics","Enable scroll metrics")),Object(a.c)("noBackPlateOnHover","no BackPlate on hover")),Object(a.c)("enableFilledIconOnHover","Enables filled icon on hover")),Object(a.c)("largeSizeReactionIcons","Enables the large size reaction icons")),Object(a.c)("smallSizeReactionIcons","Enables the small size reaction icons")),Object(a.c)("isTransparentAdSlugWithBorder","whether enable the new ad slug with transparent background and border")),Object(a.c)("enableDarkTwoColumnCard","Flag to indicate whether we enable dark color for two column article card")),Object(a.c)("enableOneColumn","Enable one column")),Object(a.c)("enableInfopaneLike2cCard","Config to make 2c card in article template displays like it in infopane template")),Object(a.c)("enableLinearFeed2cVerticalGradientCard","make 2c card in linear feed gradient verticaly")));var j,A=i("D57K"),w=i("7qs3"),I=i("VFke"),T=i("cxul"),R=i("hdNv"),P=i("EcDr"),M=i("HN5f"),k=i("s9+9"),E=i("+Ht2"),F=i("LJMo");!function(e){e[e.largeGap=10]="largeGap",e[e.midGap=8]="midGap",e[e.tinyGap=6]="tinyGap",e[e.miniGap=4]="miniGap"}(j||(j={}));const x=()=>!!Object(E.c)(k.a.ChromiumPageSettings).getCurrentState().verticalTabsOpened,D=e=>Boolean(e&&e in j),N=e=>!e,L=e=>{const{layoutGap:t,horizontalTabLayoutGap:i,consumeVerticalTab:a}=e,n=a&&!x()?i:t;return D(n)?n:void 0},U=e=>{const{reverseLayoutGap:t}=e;if(N(t)){const t=L(e);return D(t)?{gap:t+"px"}:void 0}},W=e=>{const{enableWillChange:t}=e;if(t)return{"will-change":"auto"}},B=e=>t=>{if(e===F.a.ShoppingCarousel)return;const{fixedCardHeight:i,reverseLayoutGap:a}=t;if(!N(a))return;const n=L(t);if(!i||!D(n))return;return{"grid-auto-rows":((304-n)/2).toFixed(1)+"px"}};var H=i("Jw3B"),$=i("plCa"),q=i("0dho");class V{constructor(e,t){this.props=e,this.listener=t,this.onBreakpointChange=(e=this.manager.currentColumnArrangement)=>{const t=this.calcColumnArrangement(e);this.listener(t)}}updateProps(e){Object.assign(this.props,e)}attach(){this.manager.subscribe(this.onBreakpointChange)}detach(){this.manager.unsubscribe(this.onBreakpointChange)}calcLayout(e){switch(e){case H.a.c1:return this.props.enableOneColumn?H.a.c1.toUpperCase():H.a.c2.toUpperCase();case H.a.c5:return q.a.fiveColSupported()?H.a.c5.toUpperCase():H.a.c4.toUpperCase();default:return e.toUpperCase()}}get manager(){return Object($.a)()}calcColumnArrangement(e){return this.props.hasRightRail?this.updateColumnArrangementForRightRail(e):e}updateColumnArrangementForRightRail(e){switch(e){case H.a.c5:return H.a.c4;case H.a.c4:return H.a.c3;case H.a.c3:return H.a.c2;case H.a.c2:return H.a.c1;default:return e}}}var G=i("u5KZ"),z=i("JnE6");var _=i("+qLX"),Q=i("9RHM"),J=i("w0HK");const K=(e,t,i)=>{var a;return e.id===t&&(null!==(a=e.metadata)&&void 0!==a||(e.metadata={}),e.metadata.actions=i,!0)};class Z{constructor(e){this.cardAction=e,this.openCardAction=e=>{this.cardAction.updateCardActionProps(e)},this.updateCardAction=(e,t,i)=>{const a=Object(R.i)(t),n=i.riverSectionFeedLayoutData.map(t=>{const[n,s]=this.buildMetadata(t.cardMetadataList,e,a);return s?this.createFeedData(t.templateId,n,i):t});i.riverSectionFeedLayoutData=n},this.goToPersonalizeCallback=(e,t)=>{var i;if(!e)return;const a=Object(J.a)();let n="muted-publishers"===t?{isRequestFromMutePublisherToast:!0,noScroll:!0}:{};(null===(i=e.context)||void 0===i?void 0:i.navigateToPersonalize)&&(n=e.context),a.switchPivot({pivotId:e.pivotId,configIndexHref:e.configIndexHref,configIndexRef:e.configIndexRef,context:Object.assign(Object.assign({},n),{isRequestFromSdCardAddRemoveClick:!1}),telemetryPageName:_.a.Interests,display:e.displayName})}}buildMetadata(e=[],t,i){return e.reduce(([e,a],n)=>{if(n.type===F.a.Infopane){const s=n,r=s.subItems.some(e=>K(e,t,i));return[e.concat(s),a||r]}const s=n,r=K(s,t,i);return[e.concat(s),a||r]},[[],!1])}createFeedData(e,t,i){return{feedData:i.mapFeedData(t,e,-1,!1,i.riverSectionTelemetryObject),templateId:e,cardMetadataList:Object(Q.a)(t)}}}const X=e=>e.type===F.a.Infopane,Y=e=>e.type===F.a.NativeAd,ee=e=>e.type===F.a.CmsAd;var te,ie,ae,ne=i("Ac7j"),se=i("jE1l"),re=i("mXQk"),oe=i("wXkv"),ce=i("Bwzq");!function(e){e.Disabled="disabled",e.OnScroll="onScroll",e.Alwasy="always"}(te||(te={})),function(e){e.Modal="Modal",e.Upsell="Upsell"}(ie||(ie={})),function(e){e.Long="long",e.Short="short"}(ae||(ae={}));var de=i("f/Yt"),le=i("Uw7R"),he=i("+djJ"),ue=i("XlyT"),pe=i("HxRh"),ge=i("YUMq"),ve=i("rGfm"),be=i("Z3LZ"),me=i("+8mm"),fe=i("5Aq4"),Oe=i("tERu"),Ce=i("BQg2"),Se=i("rvYQ"),ye=i("VbA2"),je=i("msIb"),Ae=i("6ADy"),we=i("KETb"),Ie=i("XMfh"),Te=i("ac9z"),Re=i("/+Un");class Pe{constructor(e){this.config=e}fetch(e){return Object(A.a)(this,void 0,void 0,(function*(){let t=this.config.initialRequest;if(e&&(t=Object.assign(Object.assign({},t),e)),!t)return G.a.sendAppErrorEvent(Object.assign(Object.assign({},pe.lg),{message:"default SDService fetch configuration was invalid"})),this.responseStatus=Ie.a.InvalidRequest,{status:this.responseStatus,cards:void 0};return yield this.fetchSDCards(t)}))}fetchSDCards(e){return Object(A.a)(this,void 0,void 0,(function*(){const t={credentials:"include",headers:yield je.a.getOneServiceFeedCallHeaders(),method:"GET"},i=new URL(fe.k,Object(Ae.b)()),a=Object(Te.b)();this.requestQueryParams=new Ce.a,Object(fe.o)(e,this.requestQueryParams);const n=(yield Object(Re.d)())===Oe.c.SignedIn?je.a.getOneServiceParamsWithAuth(Se.a.UserId,e.ocid,!1):je.a.getOneServiceParamsWithoutAuth(Se.a.UserId,e.ocid,!1);for(let e=0;e<n.length;e++)this.requestQueryParams.set(n[e].key,n[e].value);let s;Se.a.SendFeedCallActivityIdInHeader&&this.requestQueryParams.delete(fe.m.activityId),this.requestQueryParams.set(fe.m.market,Se.a.CurrentMarket),a>0&&this.requestQueryParams.set(Te.a,a.toString()),this.requestQueryParams.get("$top")||this.requestQueryParams.set("$top","1"),this.requestQueryParams.get("User")||(this.requestQueryParams.set("User",Se.a.UserId),this.requestQueryParams.delete(fe.m.user)),i.search=this.requestQueryParams.toString();try{const e=1e4,a=yield Object(we.b)(()=>Object(A.a)(this,void 0,void 0,(function*(){return yield Object(ye.a)(decodeURIComponent(i.href),e,t)})),"SDCardProvider.fetch");if(!a||!a.ok){const e=a?`SDService returned error response. status: ${a.status} - ${a.statusText}`:"SDService response was null";return G.a.sendAppErrorEvent(Object.assign(Object.assign({},pe.ng),{message:e,pb:Object.assign(Object.assign({},pe.ng.pb),{customMessage:`ServiceUrl: [${i.href}], requestHeaders: [${JSON.stringify(t&&t.headers)}]`})})),void(this.responseStatus=Ie.a.Failed)}s=yield a.json()}catch(e){return G.a.sendAppErrorEvent(Object.assign(Object.assign({},pe.mg),{message:"Error while fetching SDService response",pb:Object.assign(Object.assign({},pe.mg.pb),{customMessage:`Error: ${e} serviceUrl: ${i.href} headers: ${JSON.stringify(t.headers)} activityId: ${Se.a.ActivityId}`})})),void(this.responseStatus=Ie.a.Failed)}return s&&s.cards&&s.cards.length>0?this.responseStatus=Ie.a.Success:this.responseStatus=Ie.a.NoContent,s}))}}let Me;const ke=e=>Object(A.a)(void 0,void 0,void 0,(function*(){let t;if(Me)try{t=yield Me.fetch(e)}catch(e){}return t}));var Ee,Fe=i("8f7u"),xe=i("J48h"),De=i("ssy2");class Ne{constructor(e={}){this._state=e}setMoneyState(e){this._state=Object.assign(Object.assign({},this._state),e)}getMoneyState(){return Object.assign({},this._state)}}class Le{constructor(e){this.config=e,this.addedQuoteIds=[],this.navigateToDataProvider=()=>{this.config&&window.open(this.config.financeDataProviderPage,"_blank")},this.hideCard=()=>Object(A.a)(this,void 0,void 0,(function*(){return yield this.financeUserService.enableDisableMoneyCard(!1)})),this.handleNavClick=(e,t)=>Object(A.a)(this,void 0,void 0,(function*(){let t=this.moneyStateManager.getMoneyState().multiTabQuoteItems;if(t&&t[e]||(yield this.refreshData(),t=this.moneyStateManager.getMoneyState().multiTabQuoteItems),!t)return;const i=t[e];if(e===Fe.b.Watchlist){const a=this.moneyStateManager.getMoneyState().suggestedQuoteItems||[],[n,s]=this.getCorrectWatchlist(i,a);t[Fe.b.Watchlist]=i,this.moneyStateManager.setMoneyState({cardType:xe.c.EdgeShowData,quoteItems:n,suggestedQuoteItems:s,multiTabQuoteItems:t,activeTab:e})}else this.moneyStateManager.setMoneyState({cardType:xe.c.EdgeShowData,quoteItems:i,activeTab:e})})),this.handleAddToWatchlist=e=>Object(A.a)(this,void 0,void 0,(function*(){let t=this.addedQuoteIds||[];t=[...t],t.includes(e)||t.push(e),this.addedQuoteIds=t})),this.refreshData=()=>Object(A.a)(this,void 0,void 0,(function*(){var e,t,i,a,n,s,r,o,c,d,l;yield Object(Te.e)();const h=this.financeUserService.getWatchlist(),u=this.financeService.getMarketMovers(),[p,g]=yield Promise.all([h,u]),v=null!==(t=null===(e=this.config)||void 0===e?void 0:e.maxNumQuotes)&&void 0!==t?t:3,b=null==p?void 0:p.slice(0,v),m=null!==(n=null===(a=null===(i=this.config)||void 0===i?void 0:i.marketQuoteIds)||void 0===a?void 0:a.slice(0,v))&&void 0!==n?n:[],f=null!==(o=null===(r=null===(s=this.config)||void 0===s?void 0:s.currencyQuoteIds)||void 0===r?void 0:r.slice(0,v))&&void 0!==o?o:[],O=null===(c=g.active)||void 0===c?void 0:c.slice(0,v),C=null===(d=g.gainers)||void 0===d?void 0:d.slice(0,v),S=null===(l=g.losers)||void 0===l?void 0:l.slice(0,v),y=this.getSuggestedQuoteIds(b,v),j=[...b,...m,...f,...O,...C,...S,...y],A=yield this.financeService.getQuoteSummary(j),w=this.getQuoteMapIdToItem(A),I=this.getQuoteItemsByIds(w,b),T=this.getQuoteItemsByIds(w,m),R=this.getQuoteItemsByIds(w,f),P=this.getQuoteItemsByIds(w,O),M=this.getQuoteItemsByIds(w,C),k=this.getQuoteItemsByIds(w,S),E=this.getQuoteItemsByIds(w,y),[F,x]=this.getCorrectWatchlist(I,E),D={[Fe.b.Watchlist]:F,[Fe.b.Market]:T,[Fe.b.Currencies]:R,[Fe.b.Movers]:P,[Fe.b.Gainers]:M,[Fe.b.Losers]:k,[Fe.b.Recent]:[]},N={cardType:xe.c.EdgeShowData,suggestedQuoteItems:x,multiTabQuoteItems:D},L=this.moneyStateManager.getMoneyState().activeTab;L&&(N.quoteItems=D[L]),this.moneyStateManager.setMoneyState(N)})),this.getSuggestedQuoteIds=(e,t)=>{var i,a;if(!e||e.length>=t)return[];let n=null!==(a=null===(i=this.config)||void 0===i?void 0:i.suggestedQuoteIds)&&void 0!==a?a:[];return n=n.filter(t=>!e.includes(t)),n=n.slice(0,t-e.length),n},this.getQuoteItemsByIds=(e,t)=>{if(!e||!t||0===t.length)return[];const i=[];for(let a=0;a<t.length;a+=1){const n=t[a];if(e.has(n)){const t=e.get(n);t&&i.push(t)}}return i},this.getQuoteMapIdToItem=e=>{const t=new Map;if(!e)return t;for(let i=0;i<e.length;i+=1){const a=e[i],n=a.id;t.set(n,a)}return t},this.getCorrectWatchlist=(e,t)=>{let i=e||[],a=t||[];if(t.length>0){const e=this.addedQuoteIds||[],t=a.filter(t=>e.includes(t.id));i=i.concat(t),a=a.filter(t=>!e.includes(t.id))}return[i,a]},this.financeUserService=De.FinanceServices.getFinanceUserService(),this.financeService=De.FinanceServices.getCachedFinanceService(),this.moneyStateManager=new Ne}}!function(e){e[e.InvalidRequest=0]="InvalidRequest",e[e.Success=1]="Success",e[e.NoContent=2]="NoContent",e[e.Failed=3]="Failed"}(Ee||(Ee={}));const Ue=()=>({[F.a.StockQuote]:"finance",[F.a.SportsMatch]:"sports",[F.a.SportsOlympics]:"sports",[F.a.WeatherSummary]:"weather"});function We(e){const{keys:t,result:i}=this,a=e.type;t.includes(a)&&i.push(Ue()[a])}function Be(e,t,i){var a;const{response:n}=this,s=e.type,r=null===(a=n[Ue()[s]])||void 0===a?void 0:a.find(e=>e.type===s);r&&(i[t]=r)}var He=i("r6MD");const $e=["river","resriver","river_cms"],qe=e=>t=>{const i=Object.assign(Object.assign({},t),{adLabelText:e.adLabelText,isGreyAdsLabelEnabled:e.isGreyAdsLabelEnabled,isWhiteSlug:e.isWhiteSlug,isTransparentSlug:e.isTransparentSlug,isNarrowTitleFooterGap:e.isNarrowTitleFooterGap,isTransparentAdSlugWithBorder:e.isTransparentAdSlugWithBorder,enableAdsColorBleed:e.enableAdsColorBleed,isProviderNameClickable:e.adTemplateConfig&&e.adTemplateConfig.isProviderNameClickable});return $e.includes(t.region)?(i.isProviderInFooter=e.isProviderInFooter,i.isProviderInHeader=e.isProviderInHeader,((e,t)=>{var i;if(null===(i=t.items)||void 0===i?void 0:i.length){if(e.useArticleCardTemplate){const i=Number(t.items[0].imageWidth)||Object(He.a)(e.adTemplateConfig,"imageSizeConfig.river.w"),a=Number(t.items[0].imageHeight)||Object(He.a)(e.adTemplateConfig,"imageSizeConfig.river.h");return t.items[0].imageWidth=(225*i/a).toFixed().toString(),t.items[0].imageHeight="225",t.imageWidth=t.items[0].imageWidth,void(t.imageHeight=t.items[0].imageHeight)}t.items[0].imageWidth="300",t.items[0].imageHeight="156"}})(e,i),i):i},Ve=(e,t)=>{var i;const a=null!==(i=e[t.region])&&void 0!==i?i:[];return Object.assign(Object.assign({},e),{[t.region]:a.concat(t)})},Ge=(e,t)=>{if(t)return t.map(qe(e)).reduce(Ve,{})},ze=e=>{var t;return 0===(null===(t=e.placement.items)||void 0===t?void 0:t.length)};var _e=i("cASJ"),Qe=i("H3ag"),Je=i("MRe/");class Ke{constructor(e){this.isFirstBatch=!0,this.cmsAdsConfig={documentId:"",infoPaneIndices:[],riverIndices:[]},this.infoPaneAdRegionIndexList=[],this.riverAdRegionIndexList=[],this.tabInfoPaneAdRegionIndexList=[],this.infoPaneCmsAdRegionIndexList=[],this.riverCmsAdRegionIndexList=[],this.getAdTagStyle=()=>this.nativeAdService.getAdTagStyleByLocale(),this.nativeAdService=Object(_e.b)(),this.initializeConfig(e),Object(be.j)().then(()=>{this.nativeAdService.loadCmsBackFillList()})}refreshNativeAdFetcher(e){this.initializeConfig(e),this.infoPaneAdRegionIndexList=[],this.riverAdRegionIndexList=[],this.tabInfoPaneAdRegionIndexList=[],this.infoPaneCmsAdRegionIndexList=[],this.riverCmsAdRegionIndexList=[],this.isFirstBatch=!0,this.nativeAdService.resetNativeAdService()}updateNativeAdFetcherRegionIndexList(e){this.appendIndexList(e);const{infoPaneAdRegionIndexList:t,riverAdRegionIndexList:i,infoPaneCmsAdRegionIndexList:a,riverCmsAdRegionIndexList:n}=this,s=a.length-this.cmsAdsConfig.infoPaneIndices.length,r=n.length-this.cmsAdsConfig.riverIndices.length;if(!(s>0||r>0))return;const{sections:o}=e,c=o.flatMap(e=>e.cards),d=c.filter(X).flatMap(e=>e.subItems).filter(ee).reverse(),l=c.filter(ee).reverse();Array(s<0?0:s).fill(0).forEach((e,i)=>{d[i].type=F.a.NativeAd,t.push(a.pop())}),Array(r<0?0:r).fill(0).forEach((e,t)=>{l[t].type=F.a.NativeAd,i.push(n.pop())}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t)}fetchCmsAdsContent(){return Object(A.a)(this,void 0,void 0,(function*(){const e=this.generateCmsAdRequest();if(e)try{const{infoPaneIndices:t,riverIndices:i,documentId:a}=this.cmsAdsConfig,[n,s]=e.placements,r=t.splice(0,n.indices.length),o=i.splice(0,s.indices.length),{placements:c}=yield this.nativeAdService.fetchCmsAds(e,a,[...r,...o]);return this.adsConfig.perfRemoveWait||(yield Object(be.j)()),c}catch(e){Object(ue.c)(e,pe.Ab,"Call to CMS Ad Service failed")}}))}fetchSamAdsContent(e){return Object(A.a)(this,void 0,void 0,(function*(){const t=this.generateSamAdRequest();if(t&&t.placements&&0!==t.placements.length)try{Qe.a.startMark("AdServiceCall.DesktopFeedEdgeNextWC");const{isFirstBatch:i,nativeAdService:a}=this,n=i?e:[];i&&(this.isFirstBatch=!1);const s=(yield Promise.all([this.nativeAdService.fetchSamAds(t,i,n),yield Object(Je.c)(this.adsConfig)]))[0],{placeHolderResponse:r,samResponse:o}=s;return this.adsConfig.perfRemoveWait||(yield Object(be.j)()),this.generateNativeAdResponse(r,o)}catch(e){Object(ue.c)(e,pe.Ab,"Call to SAM Ad Service failed")}finally{Qe.a.endMark("AdServiceCall.DesktopFeedEdgeNextWC")}}))}getTemplateConfig(){return this.adsConfig.useArticleCardTemplate?this.adsConfig.adTemplateConfig:{}}generateNativeAdResponse(e,t){const i=this.getTemplateConfig(),a=this.nativeAdService.updateSamAdResponse(e,t,i),{placements:n}=a;return n.filter(e=>e.items.length)}generateSamAdRequest(){var e,t,i,a;const{infoPaneAdRegionIndexList:n,riverAdRegionIndexList:s,infoPaneCmsAdRegionIndexList:r,riverCmsAdRegionIndexList:o,tabInfoPaneAdRegionIndexList:c,samAdsInitialUpperBound:d=0,leadgenAdsInitialUpperBound:l,adsConfig:h}=this,u={placements:[]};(n.length||s.length)&&(u.placements.push({region:"infopane",indices:n.splice(0),img:null===(t=null===(e=h.adTemplateConfig)||void 0===e?void 0:e.imageSizeConfig)||void 0===t?void 0:t.infopane},{region:"river",indices:d>0?s.splice(0,d):s.splice(0),img:null===(a=null===(i=h.adTemplateConfig)||void 0===i?void 0:i.imageSizeConfig)||void 0===a?void 0:a.river}),this.samAdsInitialUpperBound=-1);const p=(e,t,i,a=0)=>{u&&e&&i.length&&u.placements.push({region:t,indices:a>0?i.splice(0,a):i.splice(0)})},{enableInfopaneLeadgenNative:g,enableRiverLeadgenNative:v,enableDenseSlide:b,enableAuctionInWebWorker:m}=this.adsConfig;return p(g,"resinfopane",r),p(v,"resriver",o,l),p(b,"infopane-tab",c),this.leadgenAdsInitialUpperBound=-1,u.enableAuctionInWebWorker=m,u}generateCmsAdRequest(){var e,t;const{infoPaneCmsAdRegionIndexList:i,riverCmsAdRegionIndexList:a}=this,{enableInfopaneLeadgenNative:n,enableRiverLeadgenNative:s,adTemplateConfig:r}=this.adsConfig;let o;return n&&s||!i.length&&!a.length||(o={placements:[{region:"infopane_cms",indices:n?[]:i.splice(0),img:null===(e=null==r?void 0:r.imageSizeConfig)||void 0===e?void 0:e.infopane},{region:"river_cms",indices:s?[]:a.splice(0),img:null===(t=null==r?void 0:r.imageSizeConfig)||void 0===t?void 0:t.river}]}),o}appendIndexList(e){const{infoPaneAdRegionIndexList:t,riverAdRegionIndexList:i,infoPaneCmsAdRegionIndexList:a,riverCmsAdRegionIndexList:n,tabInfoPaneAdRegionIndexList:s}=this;t.push(...e.infoPaneAdRegionIndexList),i.push(...e.riverAdRegionIndexList),a.push(...e.infoPaneCmsAdRegionIndexList),n.push(...e.riverCmsAdRegionIndexList),s.push(...e.tabInfoPaneAdRegionIndexList||[])}initializeConfig(e){this.cloneCmsConfig(e.cmsAds),this.samAdsInitialUpperBound=e.samAdsInitialUpperBound,this.leadgenAdsInitialUpperBound=e.leadgenAdsInitialUpperBound,this.adsConfig=e}cloneCmsConfig(e){e&&(this.cmsAdsConfig={documentId:e.documentId,infoPaneIndices:Array.from(e.infopane),riverIndices:Array.from(e.river)})}}var Ze=i("MSQM"),Xe=i("8X6I"),Ye=i("SSDD");class et{constructor(){this.currentRequestBatch=0,this.currentRenderBatch=0,this.unRenderedSectionBatchList=[]}reset(){this.currentRequestBatch=0,this.currentRenderBatch=0,this.unRenderedSectionBatchList=[]}recordAndUpdateRequestBatch(e){for(let t=0;t<e;t++)this.unRenderedSectionBatchList.push(this.currentRequestBatch);e>0&&this.currentRequestBatch++}checkAndUpdateRenderBatch(){const e=this.isRenderBatchExpected();return e||this.currentRenderBatch++,!e}isRenderBatchExpected(){return this.unRenderedSectionBatchList.shift()===this.currentRenderBatch}}var tt=i("OpdE"),it=i("Z118");class at{constructor(){this.contentCardMarkers=new Set,this.mapFeedTypeToExperienceIds={"content-card":d.a.articlePage,horoscopeCard:d.a.horoscopeAnswerCardWC,moneyInfoCard:d.a.moneyInfoCardWC,onThisDayCard:d.a.onThisDayCardWC,qnaCard:d.a.qna,"shopping-carousel":d.a.shoppingCardWC,sportsCard:d.a.sportsCardWC,travelDestination:d.a.travelDestination,trendingNowCard:d.a.trendingNowWC,weather:d.a.weatherCardWC},this.mapLayoutToColumns={C1:2,C2:2,C3:3,C4:4,C5:5},this.newsCardMarkerName="TTVR.ViewCards",this.sdCardsMarkerName="TTVR.SDCards",this.visualReadinessCallbackSet=!1}check(e){const t=e||"";this.contentCardMarkers.has(t)&&Object(he.d)(t)}track(e,t,i,a){if("full"===a)return void this.trackFull(e,t);if(!e||!e.feedData||this.visualReadinessCallbackSet||i!==it.b.init)return;const n=e.feedData[t],s=(null==n?void 0:n.sort((e,t)=>e.card_dom_order-t.card_dom_order))||[],r=4*(this.mapLayoutToColumns[t]||1);let o=0;for(let e=0;e<s.length&&o<r;e++){const t=s[e],i=t.id,a=t.cardSize;if(a){let e=2;switch(a){case tt.c._1x_1y:e=1;break;case tt.c._1x_2y:case tt.c._2x_1y:e=2;break;case tt.c._2x_2y:e=4}o+=e}else o+=2;const n=this.mapFeedTypeToExperienceIds[i];if("infopane"!==i&&void 0!==i)if(n)Object(he.b)(n,this.sdCardsMarkerName,!0);else if(t.imageData){const e=i;Object(he.b)(e,this.newsCardMarkerName),this.contentCardMarkers.add(e)}}this.visualReadinessCallbackSet=!0}trackFull(e,t){if(!e||!e.feedData)return;const i=e.feedData[t],a=(null==i?void 0:i.sort((e,t)=>e.card_dom_order-t.card_dom_order))||[];for(let e=0;e<a.length;e++){const t=a[e],i=t.id,n=this.mapFeedTypeToExperienceIds[i];if("infopane"!==i&&void 0!==i)if(n)Object(he.b)(n,this.sdCardsMarkerName,!0);else if(t.imageData){const e=i;Object(he.b)(e,this.newsCardMarkerName),this.contentCardMarkers.add(e)}}}}let nt;const st={},rt={},ot={};function ct(e,t="DEFAULT"){const i=st[t];if(i&&i.has(e)){(()=>i&&i.delete(e)&&0===i.size&&rt[t])()&&(nt=setTimeout(()=>0===i.size&&rt[t](null),200))}}function dt(e,t="DEFAULT"){nt&&clearTimeout(nt),st[t]||(st[t]=new Set),st[t].add(e)}var lt=i("W+kI"),ht=i("P4Ao");class ut{constructor(){if(this.forceCompleteTime=5e3,this.vptest=Object(lt.a)().get("vptest"),this.genTrackId=(e,t,i)=>`${e}${t?"-"+String(t):""}${void 0!==i?"-"+String(i):""}`.trim(),this.vptest){const e=ht.a.prototype.connectedCallback,t=this.genTrackId;ht.a.prototype.connectedCallback=function(){this.$emit(ut.vsReadyMark);const i=String(this.tagName).toLowerCase();switch(i){case"social-bar-wc":setTimeout(()=>ct(t(T.b.contentCard,this.contentId,P.a.socialBar)));break;default:ct(i)}e.call(this)},function(e="DEFAULT"){return ot[e]=ot[e]||new Promise(t=>{rt[e]=t}),ot[e]}().then(()=>{const e=Object(le.b)();Object.assign(e,{vpready:performance.now()}),performance.mark("vpready")})}}track(e){this.vptest&&e.cardMetadataList.map(e=>{var t,i;const a=M.a[e.type];let n;if(a){switch(a){case T.b.contentCard:return n=this.genTrackId(a,null===(t=e.cardContent)||void 0===t?void 0:t.id,null==e?void 0:e.regionIndex),void Object.keys(P.a).map(t=>{var i;const n=this.genTrackId(a,null===(i=e.cardContent)||void 0===i?void 0:i.id,t);dt(n),setTimeout(()=>{ct(n)},this.forceCompleteTime)});case T.b.nativeAdCard:n=this.genTrackId(a,"",null==e?void 0:e.regionIndex);break;case T.b.infopaneCard:return void(null===(i=e.subItems)||void 0===i||i.map(e=>{var t;const i=this.genTrackId(a,null===(t=e.cardContent)||void 0===t?void 0:t.id,null==e?void 0:e.regionIndex);dt(i),setTimeout(()=>{ct(i)},this.forceCompleteTime)}));case T.b.serendipityCard:n=String(T.b.trendingNowCard);break;case T.b.shoppingCarouselCard:n=String("msn-shopping-carousel");break;default:n=String(a)||""}dt(n),setTimeout(()=>{ct(n)},this.forceCompleteTime)}})}genCheck(e,t){var i;if(!this.vptest)return;let a;switch(e){case T.b.nativeAdCard:return a=this.genTrackId(e,"",null==t?void 0:t.regionIndex),()=>ct(a);case T.b.contentCard:return a=this.genTrackId(e,null==t?void 0:t.id,null==t?void 0:t.regionIndex),e=>ct(this.genTrackId(a,e));case T.b.infopaneCard:null===(i=t.subItems)||void 0===i||i.map(t=>{var i;const a=this.genTrackId(e,null===(i=t.cardContent)||void 0===i?void 0:i.id,null==t?void 0:t.regionIndex);t.visualReadinessCallback=()=>ct(a)});break;default:return a=this.genTrackId(e,null==t?void 0:t.id,null==t?void 0:t.regionIndex),()=>ct(a)}}}let pt;ut.vsReadyMark="vsReady";let gt=!1;const vt=(e,t,i)=>{var a;if(i)return pt=i;const n=(s=e.initialRequest.feedId!==t.feedId,gt=s,gt);var s;const r=Object.assign(Object.assign({},e),{initialRequest:Object.assign(Object.assign({},e.initialRequest),{feedId:t.feedId,feedName:null!==(a=t.feedName)&&void 0!==a?a:e.initialRequest.feedName,feedSource:t.feedSource})});return pt=new it.a(r,n)},bt=(e,t)=>e.findIndex(e=>e.type===t);var mt,ft=i("7oW3"),Ot=i("/FrS"),Ct=i("hme2"),St=i("I6Lx"),yt=i("dTwT"),jt=i("oePG"),At=i("QBS5"),wt=i("DYG5"),It=i("QHbP"),Tt=i("wZHk"),Rt=i("Cj5D"),Pt=i("zZnt"),Mt=i("oIHq"),kt=i("eoyk"),Et=i("vmYD"),Ft=i("lV/q"),xt=i("IqCT"),Dt=i("ejtM"),Nt=i("AMBy"),Lt=i("S8sE");de.a,Et.a,function(e){e[e.FirstFetchAndRenderContent=0]="FirstFetchAndRenderContent",e[e.SubFetchAndRenderContent=1]="SubFetchAndRenderContent",e[e.RenderContent=2]="RenderContent"}(mt||(mt={}));const Ut=Object(le.b)();let Wt,Bt=!1;var Ht;!function(e){e.Edit="edit",e.Hide="hide",e.More="more",e.DataProvider="dataProvider"}(Ht||(Ht={}));const $t="work";class qt extends xt.a{constructor(){super(...arguments),this.sdCardMenuOpen=!1,this.riverSectionFeedLayoutData=[],this.riverPlaceholderData=[],this.renderedRiverCount=0,this.renderedRiverPlaceholderCount=0,this.overrideWillChangeStyles="",this.overrideGapStyles="",this.getOverrideGridStyles=e=>this.getOverrideStyles([B(e)]),this.coldStartFreResponse=null,this.hasRightRail=!1,this.previousRiverSectionContentResponse=null,this.unRenderedLayoutTemplate=[],this.unRenderedRiverContent=[],this.isFetchingContent=!1,this.isFirstFeedCall=!0,this.isSentinelInView=!1,this.isPlaceholderLowerSentinelInView=!1,this.isPlaceholderUpperSentinelInView=!1,this.enableScrollDownTopSiteInf=!1,this.initFirstDone=!1,this.readyForPrefetch=!1,this.disablePrefetchHack=!1,this.ttvrFired=!1,this.beaconService=new Mt.a,this.waitingAdsMap=new Map,this.unServedSamAdSet=new Set,this.adLabelText="Ad",this.isGreyAdsLabelEnabled=!1,this.infoPaneNativeAdsMap=[],this.tabInfoPaneNativeAdsMap=[],this.riverNativeAdsMap=[],this.cmsInfopaneNativeAdsMap=[],this.cmsRiverNativeAdsMap=[],this.awayTimestamp=1/0,this.ttvrCurrentCountMap={},this.ttvrMaxCountMap={},this.scrollRenderMetadataMap=new Map,this.throttledScheduleAndSendScrollMetrics=Object(wt.a)(this.scheduleAndSendScrollMetrics.bind(this),200),this.isGetContentForNextFeedBlocked=!1,this.paginationObserverMap=new Map,this.renderHelper=new et,this.layoutTemplateList=[],this.rowCountList=[],this.ttvrMarkersHelper=new at,this.vpReadyHelper=new ut,this.setupPaginationObserver=e=>{e.map(([e,t])=>{const i=Object(Nt.a)(t);e&&(null==i||i.observe(e),this.paginationObserverMap.set(e,i))})},this.clearPaginationObserver=()=>{this.paginationObserverMap.forEach((e,t)=>{null==e||e.unobserve(t)}),this.paginationObserverMap.clear()},this.handleDocumentVisibilityChange=()=>{"visible"===document.visibilityState?!Bt&&(Bt=!0,St.b.IsPrerender)||this.checkAwayTime():this.updateAwayTime()},this.onScrollForPrefetch=()=>{this.enableScrollDownTopSiteInf&&document.documentElement.scrollTop<=54||(this.prefetchOnlyFirstTime(),window.removeEventListener("scroll",this.onScrollForPrefetch))},this.createArgs=(e,t,i,a)=>{var n,s;const{config:r}=this,{cardMetadata:o}=t,c=I.a[t.layoutTemplateName],{rowHeightPx:d,colWidthPx:l,gutterPx:h}=c,u=this.getVisualReadinessCallback(e,o,a),p=Object.assign(Object.assign({},t),{cardActionBitMask:r.cardActionBitMask||7,isAnaheimDesign:!0,goToPersonalizeCallback:e=>this.cardAction.goToPersonalizeCallback(this.config.oneRiverInterestsPivotInfo,e),initCardAction:null===(n=this.cardAction)||void 0===n?void 0:n.openCardAction,cardActionClickHandler:(e,t,i,a,n,s,r)=>(this.cardActionServiceClient.PostCardActionEvent(t,i,e,void 0,a&&n?n:void 0,s,r),this.cardAction.updateCardAction(e,t,this)),visualReadinessCallback:u,localizedStrings:r.localizedStrings,configOptions:Object(Q.a)(r),layoutGap:(g=r.layoutGap,v=r.consumeVerticalTab,b=r.reverseLayoutGap,!b&&g&&D(g)&&(!v||v&&x())?r.layoutGap:void 0),stockImageData:r.stockImageData,enableRichSocialReaction:this.feedSource!==$t&&r.enableRichSocialReactions,isAdFeedbackV1Enabled:Boolean(r.adFeedbackV1Enabled),handleAdFeedbackSubmit:this.cardActionServiceClient.ReportAd,useInlineSvgIcons:!0,sdCardActionClickHandler:this.sdCardMenuClickHandler,refreshFeedCallback:()=>this.refreshFeed(),goToPersonalizeSettingsCallback:this.navigateToPersonalizeSetting,hideCardCallback:this.hideCard,dismissSDCardMenuCallback:this.dismissSDCardMenu,isClarityEnabled:this.config.isClarityEnabled,isBlurred:r.isBlurred,rowCount:this.rowCountList[a||0],rowHeightPx:d,colWidthPx:l,gutterPx:h});var g,v,b;return null===(s=Dt.a[e])||void 0===s||s.call(Dt.a,p,o,this,i),p},this.genTtvrCallback=(e,t,i)=>{const a=e===T.b.contentCard,n=Boolean(Object(R.b)(t)),s=a&&n&&""!==t.id;return e===T.b.infopaneCard?this.setVisuallyReadyMarkers:s?()=>{this.ttvrMarkersHelper.check(t.id)}:this.setSubsequentTtvr.bind(this,i)},this.getVisualReadinessCallback=(e,t,i)=>{const a=this.genTtvrCallback(e,t,i),n=this.vpReadyHelper.genCheck(e,t);if(a||n)return(e=P.b.ALL,t)=>{e&P.b.TTVR&&a&&a(),e&P.b.VP&&n&&n(t)}},this.setVisuallyReadyMarkers=()=>{this.ttvrFired||(this.ttvrFired=!0,window.requestAnimationFrame(()=>{setTimeout(()=>{var e,t;Object(he.b)(d.a.desktopFeedEdgeNextWC,"TTVR.Infopane",!0),Object(he.m)(d.a.desktopFeedEdgeNextWC);const i=Object(be.g)();i&&(null===(t=null===(e=null===me.a||void 0===me.a?void 0:me.a.updateVisuallyReadyTiming)||void 0===e?void 0:e.getActionSender(i))||void 0===t||t.send(Object(be.c)(d.a.desktopFeedEdgeNextWC,void 0,void 0,void 0,window.performance.now())))},0)}))},this.setSubsequentTtvr=e=>{this.config.enableScrollMetrics&&e&&e>0&&(this.ttvrCurrentCountMap[e]?this.ttvrCurrentCountMap[e]++:this.ttvrCurrentCountMap[e]=1,this.ttvrCurrentCountMap[e]===this.ttvrMaxCountMap[e]&&this.markScrollRenderEndTime(e))},this.refreshSDCard=()=>Object(A.a)(this,void 0,void 0,(function*(){let e=[];e=e.concat(this.getRenderedSDCardKeys()).concat(this.getUnRenderedSDCardKeys());const t=yield ke({contentType:e.join(",")});t&&(this.updateSDCard(t),this.updateUnRenderedSDCard(t))})),this.sdCardMenuClickHandler=(e,t)=>{let i={};switch(t){case T.b.weatherCard:case T.b.trafficCard:break;case T.b.moneyCard:i={[Ht.DataProvider]:this.navigateToMoneyDataProvider,[Ht.Hide]:this.hideMoney};break;case T.b.sportsCard:case T.b.sportsOlympicCard:}i[Ht.More]=this.navigateToPersonalizeSetting,e.menuItems.forEach(e=>{const t=e.id,a=i[t];a&&(e.onClick=a)}),e.onDismiss=this.dismissSDCardMenu,this.toggleSDCardMenu(e)},this.handleDocumentClick=e=>{var t,i,a,n;const s=e.composedPath()[0],r=null===(i=null===(t=this.sdCardMenuProps)||void 0===t?void 0:t.referrerButton)||void 0===i?void 0:i.contains(s),o=null===(n=null===(a=this.sdCardMenuRef)||void 0===a?void 0:a.shadowRoot)||void 0===n?void 0:n.contains(s);r||o||this.dismissSDCardMenu()},this.dismissSDCardMenu=()=>{this.sdCardMenuOpen=!1},this.toggleSDCardMenu=e=>{this.sdCardMenuProps=e,this.sdCardMenuOpen=!this.sdCardMenuOpen},this.navigateToPersonalizeSetting=()=>{var e,t;const i=this.config.oneRiverInterestsPivotInfo;if(i){if(null===(e=i.context)||void 0===e?void 0:e.navigateToPersonalize){const e=null===(t=i.children)||void 0===t?void 0:t.find(e=>"experienceSettings"===e.pivotId);e&&Object(Rt.b)(e,!1)}else Object(Rt.b)(i,!1);this.sdCardMenuOpen=!1}},this.retrieveAndUpdateSDCard=e=>Object(A.a)(this,void 0,void 0,(function*(){yield Object(Te.e)();const t=yield ke({contentType:Ue()[e]});t&&this.updateSDCard(t)})),this.hideCard=()=>Object(A.a)(this,void 0,void 0,(function*(){var e;yield Object(Te.d)(),this.refreshFeed();const t=Object(E.c)(k.a.ChromiumPageSettings);if(t){const{sdCardSettings:i}=t.getCurrentState();if(!i)return;i.weatherVisible=!1,null===(e=ne.a.updateLocalStorage.getActionSender(t))||void 0===e||e.send(i)}else if(Object(yt.a)().supported){const e=Object(yt.a)().getObject(Pt.b,Pt.a);e&&(e.weatherVisible=!1),Object(yt.a)().setObject(Pt.b,e)}})),this.navigateToMoneyDataProvider=()=>{this.money.navigateToDataProvider(),this.dismissSDCardMenu()},this.hideMoney=()=>Object(A.a)(this,void 0,void 0,(function*(){const e=yield this.money.hideCard();return this.dismissSDCardMenu(),e&&(yield this.hideCard()),e})),this.handleMoneyNavClick=(e,t)=>Object(A.a)(this,void 0,void 0,(function*(){yield this.money.handleNavClick(e,t),this.updateSDCard()})),this.handleRefreshMoneyData=()=>Object(A.a)(this,void 0,void 0,(function*(){yield this.money.refreshData(),this.updateSDCard()})),this.initializeColdStartExperience=()=>Object(A.a)(this,void 0,void 0,(function*(){var e,t;if(null===(e=this.config.childExperienceReferencesWC)||void 0===e?void 0:e.coldStartModal){yield Object(be.j)();try{const e=yield Object(Ct.a)().getFreArtifacts();if(!e)return;e.fre?this.coldStartFreResponse=e:(null===(t=e.subCards)||void 0===t?void 0:t.length)&&Object(ue.b)(pe.Ue,"FRE request was made but returned no flag or empty data")}catch(e){Object(ue.c)(e,pe.te,"Getting data for the required artifacts failed in desktop feed when initializing cold start experience")}}})),this.closeColdStartExperience=()=>{this.coldStartFreResponse=null},this.getAdTagStyle=()=>{const{adLabelText:e,isGreyAdsLabelEnabled:t}=this.nativeAdFetcher.getAdTagStyle();this.adLabelText=e,this.isGreyAdsLabelEnabled=t},this.fetchAndHandleCmsAds=()=>Object(A.a)(this,void 0,void 0,(function*(){const e=yield this.nativeAdFetcher.fetchCmsAdsContent();e&&(this.updateCmsNativeAdMap(e),this.updateNativeAdInRiverSections())})),this.fetchAndHandleSamAds=e=>Object(A.a)(this,void 0,void 0,(function*(){const t=yield this.nativeAdFetcher.fetchSamAdsContent([e=>this.updateNativeAdMap(e.callbackFnPlacementList),()=>this.updateNativeAdInRiverSections()]);t&&0!==t.length&&(this.updateNativeAdMap(t),this.updateNativeAdInRiverSections(),this.fireServedTrackingCallForPlacements(t,e))})),this.updateNativeAdMap=e=>{const t=Ge(this.nativeAdConfig,e);if(!t)return;const{infopane:i=[],resinfopane:a=[],river:n=[],resriver:s=[],"infopane-tab":r=[]}=t;return this.infoPaneNativeAdsMap=this.infoPaneNativeAdsMap.concat(i).concat(a),this.riverNativeAdsMap=this.riverNativeAdsMap.concat(n).concat(s),this.tabInfoPaneNativeAdsMap=this.tabInfoPaneNativeAdsMap.concat(r),this}}experienceConnected(){Promise.all([Object(be.h)(),Object(be.j)()]).then(()=>{this.readyForPrefetch=!0}),this.breakpoint=new V({hasRightRail:this.hasRightRail,enableOneColumn:!!this.config.enableOneColumn},e=>{var t;this.layout=null===(t=this.breakpoint)||void 0===t?void 0:t.calcLayout(e)}),this.breakpoint.onBreakpointChange(),this.breakpoint.attach(),this.perfTimeline&&(this.mapFeedData=this.perfTimeline.instrumentFunc("mapFeedData",this.mapFeedData,this)),this.enableScrollDownTopSiteInf=function(e){const t=Object(E.c)(k.a.TopSitesLayoutData),i=Object(E.c)(k.a.ChromiumPageSettings);if(t&&i){const a=t.getCurrentState(),n=i.getCurrentState(),s="always"===n.selectedFeedDisplaySetting;if(e&&s&&n.quickLinksEnabled&&a.isTopSitesCollapsed){const e=document.documentElement?document.documentElement:document.body;if(e){const t=e=>{e&&(e.preventDefaultScroll=!0,G.a.scheduleContentViewEvent(z.b.AutoScroll)),document.removeEventListener("scroll",t)};return document.addEventListener("scroll",t),e.scrollTop=54,!0}}}return!1}(!!this.config.scrollDownTopSiteInf),document.addEventListener("visibilitychange",this.handleDocumentVisibilityChange),this.nativeAdFetcher=new Ke(this.config),this.getAdTagStyle();const e=this.config.riverSectionCardProviderConfig;Me=new Pe(e),this.money=new Le(this.config.moneyCardConfig);const{feedId:t,feedName:i,feedSource:a}=this;this.addPageConfiguration(e),vt(e,{feedId:t,feedName:i,feedSource:a},this.riverCardProvider),this.riverSectionTelemetryObject=this.telemetryObject.addOrUpdateChild({name:"River",content:{headline:t||i||"RiverSection"}}),ve.a.refreshRiver.registerObserver(()=>Object(A.a)(this,void 0,void 0,(function*(){yield Object(Te.d)(),this.refreshFeed()}))),kt.a.updateLayout.registerObserver(()=>Object(A.a)(this,void 0,void 0,(function*(){this.overrideGapStyles=this.getOverrideStyles([U])}))),this.initFeed(),this.overrideWillChangeStyles=this.getOverrideStyles([W]),this.overrideGapStyles=this.getOverrideStyles([U]),this.cardActionServiceClient=Object(w.a)();const n=Se.a.CurrentRequestTargetScope&&Se.a.CurrentRequestTargetScope.pageExperiments;n&&n.includes("prg-wpo-sub-c")&&G.a.addOrUpdateTmplProperty("PUBCAR","0")}shadowDomPopulated(){var e,t;const{shadowRoot:i}=this;if(!i)return;const a=[];if(this.config.enableGreyBlock){const{riverPlaceHolderUpperSentinel:e,riverPlaceHolderLowerSentinel:t}=this;a.push([e,this.riverPlaceholderUpperCallback.bind(this)],[t,this.riverPlaceholderLowerCallback.bind(this)])}else{const{riverSentinel:e}=this;a.push([e,this.riverPaginationCallback.bind(this)])}this.setupPaginationObserver(a);const n=Object(It.a)(Tt.a.cardAction);this.cardAction=new Z(n),document.addEventListener("mousedown",this.handleDocumentClick),null===(e=this.coldStartContainerElement)||void 0===e||e.addEventListener(re.a,this.closeColdStartExperience),null===(t=this.coldStartContainerElement)||void 0===t||t.addEventListener(re.b,this.closeColdStartExperience),this.config.enableScrollMetrics&&(this.sectionIntersectionObserver=new IntersectionObserver(this.sectionVisiblityCallback.bind(this),{threshold:.2}),document.addEventListener("scroll",this.throttledScheduleAndSendScrollMetrics))}disconnectedCallback(){var e,t;window.removeEventListener("scroll",this.onScrollForPrefetch),document.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange),this.breakpoint.detach(),null===(e=this.coldStartContainerElement)||void 0===e||e.removeEventListener(re.a,this.closeColdStartExperience),null===(t=this.coldStartContainerElement)||void 0===t||t.removeEventListener(re.b,this.closeColdStartExperience),this.clearPaginationObserver(),this.config.enableScrollMetrics&&document.removeEventListener("scroll",this.throttledScheduleAndSendScrollMetrics)}checkAwayTime(){const{idleTimeout:e,idleControl:t}=this.config;if(!e)return;(new Date).getTime()<this.awayTimestamp+e||(G.a.addOrUpdateTmplProperty("idleAutoRefresh","1"),G.a.sendClientLogEvent({message:"IAR is triggered",type:"information"}),t||(this.ttvrFired=!1,this.refreshFeed(),G.a.sendPageView({page:{name:"IAR",isAutoRefresh:!0}})))}updateAwayTime(){this.awayTimestamp=(new Date).getTime()}refreshFeed(){this.resetParameters(),this.renderNextFeed(it.b.refresh)}initFeed(){this.resetParameters(),this.renderNextFeed(it.b.init)}updateFeed(){this.noPreviousResp()||Object(be.j)().then(()=>this.renderNextFeed(it.b.subsequent))}updatePlaceholder(){Object(be.j)().then(()=>{const e=Array(10).fill(null).map(()=>({type:F.a.PlaceholderCard}));this.riverPlaceholderData.push({feedData:this.mapFeedData(e,"msft-ten-card-five-col",-1),templateId:"msft-ten-card-five-col",cardMetadataList:e}),this.renderedRiverPlaceholderCount=this.renderedRiverPlaceholderCount+1})}initAtFirst(){return Object(A.a)(this,void 0,void 0,(function*(){if(yield Object(Ze.a)(),this.noPreviousResp())return;this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds();const{selectedFeedDisplaySetting:e}=Object(E.c)(k.a.ChromiumPageSettings).getCurrentState();("peek"===e||this.config.legacyPrefetchBehavior===te.Disabled)&&(this.disablePrefetchHack=!0),this.config.legacyPrefetchBehavior===te.OnScroll?setTimeout(()=>window.addEventListener("scroll",this.onScrollForPrefetch)):this.prefetchOnlyFirstTime()}))}renderNextFeedWithPrefetch(e){return Object(A.a)(this,void 0,void 0,(function*(){let t=mt.RenderContent;if(this.isEmpty()){const i=this.prefetchHandler?yield this.prefetchHandler:yield this.getContentForNextFeed(e);if(!i&&!this.isFetchingContent)return void this.fallbackToRiverSentinel();if(!i)return void(this.isGetContentForNextFeedBlocked=!0);this.isFirstFeedCall&&(t=mt.FirstFetchAndRenderContent,this.isFirstFeedCall=!1)}if(!this.addRiverSections(e))return;const i=this.renderHelper.checkAndUpdateRenderBatch();switch(this.addWaitingIndex(this.riverSectionFeedLayoutData.length-1),t){case mt.FirstFetchAndRenderContent:yield this.initAtFirst();break;case mt.RenderContent:i?(this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds()):this.updateNativeAdInRiverSections()}this.shouldPrefetch()&&(this.prefetchHandler=this.getContentForNextFeed(it.b.subsequent).then(e=>e).catch(()=>!1).finally(()=>{this.prefetchHandler=void 0}))}))}renderNextFeed(e){return Object(A.a)(this,void 0,void 0,(function*(){if(this.config.isNewPrefetchlogic)return this.renderNextFeedWithPrefetch(e);let t=mt.RenderContent;if(this.isEmpty()){const i=yield this.getContentForNextFeed(e);if(!i&&!this.isFetchingContent)return void this.fallbackToRiverSentinel();if(!i)return void(this.isGetContentForNextFeedBlocked=!0);this.isFirstFeedCall?(t=mt.FirstFetchAndRenderContent,this.isFirstFeedCall=!1):t=mt.SubFetchAndRenderContent}this.addRiverSections(e);const i=this.riverSectionFeedLayoutData.length-1;this.addWaitingIndex(i),t===mt.FirstFetchAndRenderContent?yield this.initAtFirst():t===mt.SubFetchAndRenderContent?(this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds()):t===mt.RenderContent&&this.updateNativeAdInRiverSections()}))}renderedRiverCountChanged(){Wt&&clearTimeout(Wt),Wt=window.setTimeout(()=>{const{isSentinelInView:e}=this;if(e&&this.updateFeed(),this.config.enableScrollMetrics){const e=this.selectAllSections();e&&e.forEach((e,t)=>{var i;this.scrollRenderMetadataMap.get(e)||(this.sectionIntersectionObserver.observe(e),this.scrollRenderMetadataMap.set(e,{i:t,cc:null===(i=this.riverSectionFeedLayoutData[t].cardMetadataList)||void 0===i?void 0:i.length}))})}},100)}renderedRiverPlaceholderCountChanged(){return Object(A.a)(this,void 0,void 0,(function*(){if(0===this.renderedRiverPlaceholderCount&&this.isPlaceholderLowerSentinelInView)return yield Object(Lt.a)(),void this.updatePlaceholder();0!==this.renderedRiverPlaceholderCount&&(Wt&&clearTimeout(Wt),Wt=window.setTimeout(()=>{this.updateFeed()},100))}))}addRiverSections(e){if(!this.unRenderedLayoutTemplate.length)return!1;const t=this.unRenderedLayoutTemplate.shift(),i=I.a[t],a=this.getCardMetadataForRiverSection(i);this.config.enableScrollMetrics&&this.riverSectionFeedLayoutData.length>0&&(this.ttvrMaxCountMap[this.riverSectionFeedLayoutData.length]=a.filter(e=>M.a[e.type]===T.b.contentCard&&Boolean(Object(R.b)(e))).length);const n=e=>({feedData:this.mapFeedData(e,t,this.riverSectionFeedLayoutData.length,!0,this.riverSectionTelemetryObject),templateId:t,cardMetadataList:e}),s=i=>{this.layoutTemplateList.push(t),this.rowCountList.push({});const a=n(i);this.riverSectionFeedLayoutData.push(a),this.ttvrMarkersHelper.track(a,this.layout,e,this.config.contentTTVR),e!==it.b.init&&e!==it.b.refresh&&this.vpReadyHelper.track(a),Ut[oe.a.secondSectionRenderStart]=window.performance.now()},r=()=>{this.riverSectionFeedLayoutData=[],this.renderedRiverCount=this.riverSectionFeedLayoutData.length};return(()=>{if(e===it.b.init||e===it.b.refresh){r();const e=[...a];((e,t)=>{const i=bt(e,t),a=e[i],{subItems:n}=a||{};n&&e.splice(i,1,Object.assign(Object.assign({},a),{subItems:[n[0]]}))})(e,F.a.Infopane);const t=[F.a.WeatherSummary,F.a.SportsMatch,F.a.SportsOlympics,F.a.StockQuote,F.a.MoneyInfo];this.config.noCardFiltering||t.forEach(t=>((e,t)=>{const i=bt(e,t);-1!==i&&e.splice(i,1,Object.assign(Object.assign({},e[i]),{data:void 0}))})(e,t)),s(e),Object(be.j)().then(()=>Object(A.a)(this,void 0,void 0,(function*(){this.riverSectionFeedLayoutData=[];const e=n(a);this.riverSectionFeedLayoutData.push(e),this.vpReadyHelper.track(e);a[a.findIndex(e=>e.type===F.a.WeatherSummary)]&&(this.weatherDataConnector||(this.weatherDataConnector=yield Object(E.a)(k.a.WeatherData),ft.a.updateWeatherSettings.registerObserver(()=>Object(A.a)(this,void 0,void 0,(function*(){this.retrieveAndUpdateSDCard(F.a.WeatherSummary),Object(Xe.c)(Ye.a.WeatherChange)}))),this.weatherDataConnector&&this.weatherDataConnector.getCurrentState()&&this.weatherDataConnector.getCurrentState().settingUpdateStatus==Ot.f.Start&&this.retrieveAndUpdateSDCard(F.a.WeatherSummary)))})))}else s(a)})(),this.renderedRiverCount=this.riverSectionFeedLayoutData.length,this.riverPlaceholderData=this.riverPlaceholderData.slice(1),this.renderedRiverPlaceholderCount>0&&(this.renderedRiverPlaceholderCount=this.renderedRiverPlaceholderCount-1),!0}getCardMetadataForRiverSection(e){const t=[];if(!e)return t;for(let i=0;i<e.cardCount;i++){const e=this.unRenderedRiverContent.shift();e&&t.push(e)}return t}getContentForNextFeed(e){return Object(A.a)(this,void 0,void 0,(function*(){if(this.isFetchingContent)return!1;this.isFetchingContent=!0;const t=this.previousRiverSectionContentResponse;if((null==t?void 0:t.status)===Ie.a.NoContent)return this.isFetchingContent=!1,!1;const i=null==t?void 0:t.nextPageRequest,a=yield((e,t)=>Object(A.a)(void 0,void 0,void 0,(function*(){let i;if(pt)try{i=yield pt.fetch(e,t)}catch(e){Object(ue.c)(e,pe.Bb,"Content fetch failed for Desktop Feed EdgeNext WC river section.","Failed with exception : "+e)}return i})))(i,e);if(this.isFetchingContent=!1,!a)return!1;if(this.previousRiverSectionContentResponse=a,a.status!==Ie.a.Success)return!1;const{sections:n}=a;for(const e of n){const{cards:t,layoutTemplate:i}=e;this.unRenderedRiverContent=this.unRenderedRiverContent.concat(t),this.unRenderedLayoutTemplate.push(i)}return this.renderHelper.recordAndUpdateRequestBatch(n.length),this.updateNativeAdRegion(a),!0}))}isEmpty(){return 0===this.unRenderedLayoutTemplate.length}shouldPrefetch(){const e=this.config.numOfSectionsToPrefetch||2;return this.unRenderedLayoutTemplate.length<=e&&!this.prefetchHandler&&this.initFirstDone&&this.readyForPrefetch}noPreviousResp(){return!this.previousRiverSectionContentResponse}prefetchOnlyFirstTime(){return Object(A.a)(this,void 0,void 0,(function*(){try{this.fetchAndHandleSamAds(!0)}catch(e){}if(this.disablePrefetchHack)return void(this.initFirstDone=!0);(yield this.getContentForNextFeed(it.b.subsequent))&&(this.fetchAndHandleSamAds(!0),this.fetchAndHandleCmsAds(),this.isGetContentForNextFeedBlocked&&(this.renderNextFeed(it.b.subsequent),this.isGetContentForNextFeedBlocked=!1)),this.initFirstDone=!0}))}resetParameters(){pt&&pt.clearCache(),this.previousRiverSectionContentResponse=null,this.unRenderedLayoutTemplate=[],this.unRenderedRiverContent=[],this.renderHelper.reset(),this.isFirstFeedCall=!0,this.refreshNativeAdSections(),this.resetRowCount()}revalidateExperienceStaleState(){var e;let t=36e5;const i=null===(e=this.config.stalenessInfo)||void 0===e?void 0:e.staleThreshold;return i&&i<1&&(t=60*i*1e3),Object(he.j)(ge.d)>t?this.refreshFeed():this.refreshSDCard(),Promise.resolve(void 0)}getExperienceType(){return d.a.desktopFeedEdgeNextWC}riverPaginationCallback(e){var t;if(!e||!e.length)return;(null!==(t=e[1])&&void 0!==t?t:e[0]).isIntersecting?(this.isSentinelInView=!0,this.updateFeed()):this.isSentinelInView=!1}riverPlaceholderLowerCallback(e){var t;return Object(A.a)(this,void 0,void 0,(function*(){if(!e||!e.length)return;if((null!==(t=e[1])&&void 0!==t?t:e[0]).isIntersecting){if(this.isPlaceholderLowerSentinelInView=!0,!this.isPlaceholderUpperSentinelInView&&this.renderedRiverPlaceholderCount>0)return;yield Object(Lt.a)(),this.updatePlaceholder()}else this.isPlaceholderLowerSentinelInView=!1}))}riverPlaceholderUpperCallback(e){var t;if(!e||!e.length)return;(null!==(t=e[1])&&void 0!==t?t:e[0]).isIntersecting?this.isPlaceholderUpperSentinelInView=!0:this.isPlaceholderUpperSentinelInView=!1}mapFeedData(e,t,i,a,n){const s={cards:[],C5:[],C4:[],C3:[],C2:[],C1:[]};if(!e.length)return s;const r=I.a[t],{cardSlots:o}=r;if(i>=0)if(0===i)this.rowCountList[0]={C1:0,C2:0,C3:0,C4:0,C5:0};else if(!("C1"in this.rowCountList[i])){const e=this.rowCountList[i-1],t=I.a[this.layoutTemplateList[i-1]],{rowHeightPx:a}=t;this.rowCountList[i]={C5:e.C5+(a&&a.C5&&a.C5.length?a.C5.length/2:0),C4:e.C4+(a&&a.C4&&a.C4.length?a.C4.length/2:0),C3:e.C3+(a&&a.C3&&a.C3.length?a.C3.length/2:0),C2:e.C2+(a&&a.C2&&a.C2.length?a.C2.length/2:0),C1:e.C1+(a&&a.C1&&a.C1.length?a.C1.length/2:0)}}return e.map(e=>[M.a[e.type],e]).filter(e=>Boolean(e[0])).map(([e,t])=>e===T.b.serendipityCard?[T.b.trendingNowCard,t]:[e,t]).map(([e,s],r)=>{var c;return null===(c=T.a[e])||void 0===c?void 0:c.getFeedDataForCard(this.createArgs(e,{cardMetadata:s,parentTelemetryObject:n,cardSlot:o[r],layoutTemplateName:t,openLinksInNewTab:a},r,i))}).filter(e=>Boolean(e)).flatMap(e=>Object.entries(e)).reduce((e,[t,i=[]])=>{const a=e[t];return a?Object.assign(Object.assign({},e),{[t]:a.concat(...i)}):e},s)}getOverrideStyles(e){const{config:t}=this,i=e.reduce((e,i)=>{const a=i(t)||{};return Object.assign(Object.assign({},e),a)},{});return Object.entries(i).map(([e,t])=>`${e}:${t};`).join("")}addPageConfiguration(e){const t=Object(E.c)(k.a.ChromiumPageSettings);if(!t)return;const i=t.getCurrentState();if(!i)return;let a=!1;"function"==typeof t.getPrimaryAccountInfoAsync&&t.getPrimaryAccountInfoAsync().then(e=>{a=e.accountType===se.d.MSA});const n=Ft.a.getPageConfiguration(i,a);n&&!isNaN(n)&&(e.initialRequest.pageConfiguration=n)}getRenderedSDCardKeys(){const e=[],t=Object.keys(Ue());return this.riverSectionFeedLayoutData.slice(0,2).forEach(i=>{var a;null===(a=i.cardMetadataList)||void 0===a||a.forEach(We,{keys:t,result:e})}),e}getUnRenderedSDCardKeys(){const e=[],t=Object.keys(Ue());return this.unRenderedRiverContent.forEach(We,{result:e,keys:t}),e}updateUnRenderedSDCard(e){this.unRenderedRiverContent.forEach((t,i,a)=>{var n;const s=t.type,r=null===(n=e[Ue()[s]])||void 0===n?void 0:n.find(e=>e.type===s);r&&(a[i]=r)})}updateSDCard(e){const t=this.riverSectionFeedLayoutData.slice(0,2),i=[];t.forEach((t,a)=>{const{cardMetadataList:n,templateId:s}=t;if(!n)return;e&&n.forEach(Be,{response:e});const r=Object.assign(Object.assign({},t),{feedData:this.mapFeedData(n,s,a,!0,this.riverSectionTelemetryObject),cardMetadataList:n});i.push(r)}),this.riverSectionFeedLayoutData=[...i,...this.riverSectionFeedLayoutData.slice(2)]}refreshNativeAdSections(){this.nativeAdFetcher.refreshNativeAdFetcher(this.config),this.unServedSamAdSet.clear(),this.waitingAdsMap.clear(),this.infoPaneNativeAdsMap=[],this.riverNativeAdsMap=[],this.tabInfoPaneNativeAdsMap=[],this.cmsInfopaneNativeAdsMap=[],this.cmsRiverNativeAdsMap=[],this.layoutTemplateList=[],this.rowCountList=[]}updateNativeAdRegion(e){this.nativeAdFetcher.updateNativeAdFetcherRegionIndexList(e)}addWaitingIndex(e){const t=this.waitingAdsMap;t.has(e)||t.set(e,!0)}fireServedTrackingCallForPlacements(e,t){const i=this.beaconService.fireAdServedTrackingCall.bind(this.beaconService),{samAdNextPageUpperBound:a}=this.config,n=t&&void 0!==a?(e=>(t,a)=>{a<e?i(t):this.unServedSamAdSet.add(t)})(a):i;e.map(({beaconsJson:e,bingTrackerUrls:t=[],videoViewabilityData:i})=>!e||t.length>0&&i?null:e).filter(e=>Boolean(e)).forEach(n)}updateNativeAdInRiverSections(){if(!(this.infoPaneNativeAdsMap.length>0||this.riverNativeAdsMap.length>0||this.cmsInfopaneNativeAdsMap.length>0||this.cmsRiverNativeAdsMap.length>0||this.tabInfoPaneNativeAdsMap.length>0))return;const{riverSectionFeedLayoutData:e}=this;if(!e||!e.length)return;const t=e.map((e,t)=>{if(!this.waitingAdsMap.get(t))return e;const{cardMetadataList:i=[]}=e;let a=!1;const n=(e,t)=>{const i=this.createNativeAdCardMetadata(t,e.regionIndex);return ze(e)&&(a=!0),i},s=(e,t)=>Object.assign(Object.assign({},e),{subItems:e.subItems.map(t)}),r=i.map(e=>X(e)?s(e,e=>Y(e)&&ze(e)?n(e,"infopane"):ee(e)&&ze(e)?n(e,"infopane_cms"):e.type===F.a.Dense?s(e,e=>Y(e)&&ze(e)?n(e,"infopane-tab"):e):e):Y(e)&&ze(e)?n(e,"river"):ee(e)&&ze(e)?n(e,"river_cms"):e);return a||this.waitingAdsMap.set(t,!1),{feedData:this.mapFeedData(r,e.templateId,t,!0,this.riverSectionTelemetryObject),templateId:e.templateId,cardMetadataList:r}});this.riverSectionFeedLayoutData=t,window.requestAnimationFrame(()=>{const e=!0===St.b.IsPrerender?performance.now()-Object(he.j)(ge.d):performance.now();Object(he.q)(ce.a.TimeToRenderAd,e)});const i=!0===St.b.IsPrerender?performance.now()-Object(he.j)(ge.d):performance.now();Object(he.q)(ce.a.RenderReady,i)}get nativeAdConfig(){return Object.assign({adLabelText:this.adLabelText,isGreyAdsLabelEnabled:this.isGreyAdsLabelEnabled},this.config)}updateCmsNativeAdMap(e){const t=Ge(this.nativeAdConfig,e);if(!t)return;const{infopane_cms:i=[],river_cms:a=[]}=t;this.cmsInfopaneNativeAdsMap=this.cmsInfopaneNativeAdsMap.concat(i),this.cmsRiverNativeAdsMap=this.cmsRiverNativeAdsMap.concat(a)}createNativeAdCardMetadata(e,t){const{placement:i,type:a}=this.calcPlacementByRegionType(e,t);if(i){const{beaconsJson:n}=i;return n&&this.unServedSamAdSet.delete(n)&&this.beaconService.fireAdServedTrackingCall(n),{type:a,regionIndex:t,id:`nativead-${e}-${i.regionIndex}`,placement:i}}return{type:a,regionIndex:t,placement:{items:[]}}}calcPlacementByRegionType(e,t){let i,a=F.a.NativeAd;const n=e=>e.regionIndex===t;switch(e){case"infopane":i=this.infoPaneNativeAdsMap.find(n);break;case"river":i=this.riverNativeAdsMap.find(n);break;case"infopane-tab":i=this.tabInfoPaneNativeAdsMap.find(n);break;case"infopane_cms":i=(this.config.enableInfopaneLeadgenNative?this.infoPaneNativeAdsMap:this.cmsInfopaneNativeAdsMap).find(n),a=F.a.CmsAd;break;case"river_cms":i=(this.config.enableRiverLeadgenNative?this.riverNativeAdsMap:this.cmsRiverNativeAdsMap).find(n),a=F.a.CmsAd}return{placement:i,type:a}}fallbackToRiverSentinel(){if(!this.config.enableGreyBlock)return;this.clearPaginationObserver(),this.riverPlaceholderData=[],this.renderedRiverPlaceholderCount=0,this.isPlaceholderUpperSentinelInView=!1,this.isPlaceholderLowerSentinelInView=!1;const e=[[this.riverSentinel,this.riverPaginationCallback.bind(this)]];this.setupPaginationObserver(e)}sectionVisiblityCallback(e){var t;for(let i=0;i<e.length;i++){const a=e[i];a.isIntersecting&&!(null===(t=this.scrollRenderMetadataMap.get(a.target))||void 0===t?void 0:t.st)&&this.scrollRenderMetadataMap.set(a.target,Object.assign(Object.assign({},this.scrollRenderMetadataMap.get(a.target)),{st:window.performance.now()}))}}scheduleAndSendScrollMetrics(){const e=[];this.scrollRenderMetadataMap.forEach(t=>{t.et&&e.push(t)}),G.a.addOrUpdateTmplString("scrollMetrics:"+encodeURIComponent(JSON.stringify(e)))}selectAllSections(){var e;return null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelectorAll(".msft-feed-layout-wrapper")}markScrollRenderEndTime(e){const t=this.selectAllSections()[e];t&&this.scrollRenderMetadataMap.set(t,Object.assign(Object.assign({},this.scrollRenderMetadataMap.get(t)),{et:window.performance.now()}))}resetRowCount(){this.layoutTemplateList=[],this.rowCountList=[]}}Object(A.d)([jt.d],qt.prototype,"sdCardMenuOpen",void 0),Object(A.d)([jt.d],qt.prototype,"sdCardMenuProps",void 0),Object(A.d)([jt.d],qt.prototype,"layout",void 0),Object(A.d)([jt.d],qt.prototype,"riverSectionTelemetryObject",void 0),Object(A.d)([jt.d],qt.prototype,"riverSectionFeedLayoutData",void 0),Object(A.d)([jt.d],qt.prototype,"riverPlaceholderData",void 0),Object(A.d)([jt.d],qt.prototype,"renderedRiverCount",void 0),Object(A.d)([jt.d],qt.prototype,"renderedRiverPlaceholderCount",void 0),Object(A.d)([jt.d],qt.prototype,"overrideWillChangeStyles",void 0),Object(A.d)([jt.d],qt.prototype,"overrideGapStyles",void 0),Object(A.d)([jt.d],qt.prototype,"coldStartFreResponse",void 0),Object(A.d)([Object(At.b)({mode:"boolean"})],qt.prototype,"hasRightRail",void 0);var Vt=i("eUhr"),Gt=i("6BDD"),zt=i("+53S"),_t=i("6vBc"),Qt=i("UNqU"),Jt=i("3cVL"),Kt=i("Nt9a");Et.a;const Zt=Gt.b`
    ${e=>Object(Jt.a)(e.config.childExperienceReferencesWC.toastWC)}
`,Xt=Gt.b`
<msn-actions-menu
    :menuItems=${e=>{var t;return null===(t=e.sdCardMenuProps)||void 0===t?void 0:t.menuItems}}   
    :referrerButton=${e=>{var t;return null===(t=e.sdCardMenuProps)||void 0===t?void 0:t.referrerButton}}
    :useFastAnchoredRegion=${e=>!1}
    ${Object(zt.b)("sdCardMenuRef")}
>
</msn-actions-menu>
`,Yt=Gt.b`
    <div ${Object(zt.b)("coldStartContainerElement")}>
        ${Object(_t.a)(e=>e.coldStartFreResponse,Gt.b`
            ${e=>Object(Jt.a)(e.config.childExperienceReferencesWC.coldStartModal,{properties:{coldStartArtifact:e.coldStartFreResponse,parentContainerElement:e.coldStartContainerElement}})}
        `)}
    </div>
`,ei=Gt.b`
    <div role="main" class="desktop-feed-edgenext-root" ${Object(Vt.b)(e=>{var t;return null===(t=e.telemetryObject)||void 0===t?void 0:t.getMetadataTag()})}>
        <div class="infopane-sentinel"></div>
        <div class="feed" style="${e=>e.overrideGapStyles+e.overrideWillChangeStyles}" ${Object(Vt.b)(e=>e.riverSectionTelemetryObject.getMetadataTag())}>
            ${Object(Qt.c)(e=>e.riverSectionFeedLayoutData,Gt.b`
                <msft-feed-layout
                    style="${(e,t)=>{var i;return t.parent.overrideGapStyles+t.parent.getOverrideGridStyles(null===(i=e.cardMetadataList)||void 0===i?void 0:i[0].type)}}"
                    layout="${(e,t)=>t.parent.layout}"
                    :data="${e=>e.feedData}"
                    :cardTemplateMap="${()=>Kt.a}"
                    :layoutStyles="${e=>I.a[e.templateId].styles}"
                    class="msft-feed-layout-wrapper"
                    >
                </msft-feed-layout>
            `)}
            <div ${Object(zt.b)("riverSentinel")} id="river-sentinel" class="${e=>e.config.enableGreyBlock?"river-sentinel-grey-block":"river-sentinel"}"></div>
            ${Object(_t.a)(e=>e.config.enableGreyBlock,Gt.b`
                <div id="river-placeholder-upper-sentinel" class="river-placeholder-sentinel" ${Object(zt.b)("riverPlaceHolderUpperSentinel")} ></div>
                ${Object(Qt.c)(e=>e.riverPlaceholderData,Gt.b`
                    <msft-feed-layout
                        style="${(e,t)=>{var i;return t.parent.overrideGapStyles+t.parent.getOverrideGridStyles(null===(i=e.cardMetadataList)||void 0===i?void 0:i[0].type)}}"
                        layout="${(e,t)=>t.parent.layout}"
                        :data="${e=>e.feedData}"
                        :cardTemplateMap="${()=>Kt.a}"
                        :layoutStyles="${e=>I.a[e.templateId].styles}"
                        >
                    </msft-feed-layout>
                `)}
                <div id="river-placeholder-lower-sentinel" class="river-placeholder-sentinel" ${Object(zt.b)("riverPlaceHolderLowerSentinel")}></div>
            `)}
        </div>
        ${Object(_t.a)(e=>{var t;return null===(t=e.config.childExperienceReferencesWC)||void 0===t?void 0:t.toastWC},Zt)}
    </div>
    ${Object(_t.a)(e=>e.sdCardMenuOpen,Xt)}
    ${Yt}
`;var ti=i("kL0l");const ii=i("4X57").a`

.desktop-feed-edgenext-root {
    color: ${ti.G.var};
    margin: 0 auto;
    position: relative;
}

.infopane-sentinel {
    position: absolute;
    width: 612px;
    height: 304px;
    top: 0;
    left: 0;
    z-index: -1;
}

.feed {
    display: grid;
    flex-flow: row wrap;
    gap: 12px;
    justify-content: center;
    margin-bottom: 33px;
    --elevated-corner-radius: 6;
}

.river-sentinel {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: -1;
}

.river-sentinel-grey-block, .river-placeholder-sentinel {
    width: 100%;
    z-index: -1;
}

`.withBehaviors(ti.k,ti.G),ai={experienceConfigSchema:y}},S8sE:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i("D57K");i("roS3"),i("r6MD");setTimeout;let n=setTimeout;function s(e){return Object(a.a)(this,void 0,void 0,(function*(){return new Promise((t,i)=>{n(t,e)})}))}function r(e=1){return Object(a.a)(this,void 0,void 0,(function*(){for(let t=0;t<e;t++)yield s(0)}))}},SHdd:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return n}));var a;!function(e){e.AppAnonCookie="appanoncookie",e.MyFeed="myfeed",e.AuthToken="AuthToken",e.UpdateMyFeed="updatemyfeed",e.RefreshConfigs="refreshconfigs",e.DetectConfigChanges="detectconfigchanges",e.ClearConfigCache="clearconfigcache",e.Updatepdp="updatepdp",e.WeatherPdp="weatherpdp",e.MoneyPdp="moneypdp",e.LocalNews="localnews",e.SportsTeamPdp="sportsteampdp",e.SportsPlayerPdp="sportsplayerpdp",e.SportsLeaguePdp="sportsleaguepdp",e.PerfMarkers="perfmarkers",e.ContentPreviewData="ContentPreviewData",e.ContentPreviewCache="ContentPreviewCache",e.PostTtvr="PostTtvr",e.FeedDisplaySetting="FeedDisplaySetting",e.WebWorkerError="WebWorkerError",e.InvalidateWeatherPdp="InvalidateWeatherPdp",e.InvalidateMoneyPdp="InvalidateMoneyPdp",e.StripeMyFeed="StripeMyFeed",e.UpdateMyBriefing="UpdateMyBriefing",e.MyBriefing="MyBriefing",e.WindowsFeed="WindowsFeed",e.IndustryNewsArticles="IndustryNewsArticles",e.AuctionPrefetch="AuctionPrefetch",e.AuctionAPIDuration="AuctionAPIDuration",e.SAMWebWorkerCalled="SAMWebWorkerCalled",e.SAMMainThreadCalled="SAMMainThreadCalled"}(a||(a={}));const n={None:0,FirstCalledTimes:1,DuplicatedCalledTimes:2};var s;!function(e){e[e.Fetching=1]="Fetching",e[e.Fetched=2]="Fetched"}(s||(s={}))},XAMW:function(e,t,i){"use strict";t.a=function(e,t,i){var a;return i(e,(function(e,i,n){if(t(e,i,n))return a=i,!1})),a}},btVS:function(e,t,i){"use strict";t.a=function(e,t,i,a,n){return n(e,(function(e,n,s){i=a?(a=!1,e):t(i,e,n,s)})),i}},cASJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return Ae})),i.d(t,"b",(function(){return Ie}));var a,n=i("D57K"),s=i("XlyT"),r=i("HxRh"),o=i("+djJ"),c=i("YUMq"),d=i("pMIE"),l=i("2H+z"),h=i("r6MD"),u=i("KPQt"),p=i("CjK2"),g=i("oIHq"),v=i("rvYQ"),b=i("ADRF"),m=i("aHCm"),f=i("lifk"),O=i("iQkd");!function(e){e.SlideshowPreview="ss",e.ArticlePreview="ar",e.VideoPreview="vi"}(a||(a={}));var C=i("KETb"),S=i("u5KZ");class y{getCMSList(e,t){return Object(n.a)(this,void 0,void 0,(function*(){if(e)try{const i={method:"GET",headers:{}},a=yield Object(C.b)(()=>Object(n.a)(this,void 0,void 0,(function*(){const t=new URL(`${O.e.CMSListServiceUrl}${e}${v.a.ContentServiceUrlBase.search}`,""+v.a.ContentServiceUrlBase),a=yield fetch(t.toString(),i);if(a.ok)return a.json();S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed",`Invalid response from CMS, ${a.statusText}, listId: ${e}`))})),"getCMSList");if(!a)return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","Invalid response.json(), listId: "+e));const o=a;return this.translateToCMSItem(o,e,t,O.b.PrivacyUrl)}catch(t){return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed",`Error while fetching CMS Native Ad  ${t}, id: ${e}`))}else S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","No backfill id found, listId: "+e))}))}translateToCMSItem(e,t,i,a){return Object(n.a)(this,void 0,void 0,(function*(){if(!e||!e.list||0===e.list.length)return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","No CMS Response returned from "+t));const n=[];for(const t of e.list){let e=!1;const s=t.extendedProperties;if(s)for(const t of s)if(t.key&&t.key.indexOf("is_content")>-1&&t.values&&t.values.indexOf("true")>-1){e=!0;break}let r;if(null!=t.link&&null!=t.link.title&&t.link.href&&null!=t.link.image&&null!=t.link.image.href){const i=this.getCMSContentId(t.link.image.href);let n,s;if(t.link.ad)if(t.link.ad.providerHref&&t.link.ad.providerHref.href){const e=this.getCMSContentId(t.link.ad.providerHref.href);e?n=yield this.fetchProviderName(e):t.link.ad.sponsorText&&(n=t.link.ad.sponsorText)}else t.link.ad.sponsorText&&(n=t.link.ad.sponsorText);s=n||(null!=t.link.kicker?t.link.kicker:O.e.DefaultProviderName),r={title:t.link.title,url:t.link.href,provider:{name:s},imageUrl:i?Object(f.h)(i,{width:624,height:350,enableDpiScaling:!1}):t.link.image.href,isContent:e,privacyUrl:a}}else if(null!=t.reference&&null!=t.reference.href){const n=this.getCMSContentId(t.reference.href);if(null!=n){const t=yield this.getCMSContent(n);if(!t)continue;r={title:t.title,url:this.constructDestinationUrl(t,i),provider:this.constructProvider(t),imageUrl:this.constructImageUrl(t),isContent:e,privacyUrl:a}}}r&&r.title&&r.imageUrl&&r.url&&n.push(r)}return{id:e._id,items:n}}))}getCMSContent(e){return Object(n.a)(this,void 0,void 0,(function*(){try{const t=new URL(v.a.ContentServiceUrlBase.search,`${v.a.ContentServiceUrlBase}${O.e.CMSContentServiceURl}${e}/`),i=yield fetch(t.toString());if(!i||!i.ok)return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","Failed to fetch CMS content, cmsId: "+e));const a=yield i.json();return a||void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","Invalid JSON response to get CMS content, cmsId: "+e))}catch(t){return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed",`Error while fetching CMS content ${t}, cmsId: ${e}`))}}))}constructDestinationUrl(e,t){const{category:i}=e,n=i&&i.product||"news",s=i&&i.label||"other",r=a[e.type]||"xx";return`https://www.msn.com/${t}/${b.a.encodeURIComponentForPrime(n||"")}/${b.a.encodeURIComponentForPrime(s||"")}/${b.a.encodeURIComponentForPrime(e.title||"")}/${r}-${e.id}`}constructProvider(e){const{name:t,logo:i}=e.provider;return{name:t,logo:i&&i.id?{src:`${m.a.prod}${i.id}?w=16&h=16`,alt:t}:void 0}}constructImageUrl(e){if(e.images&&!(e.images.length<1)&&e.images[0].id)return Object(f.h)(e.images[0].id,{width:624,height:350,focalRegion:e.images[0].focalRegion,enableDpiScaling:!1})}getCMSContentId(e){return e&&e.indexOf("cms/api/amp")>-1?e.substring(e.lastIndexOf("/")+1):null}fetchProviderName(e){return Object(n.a)(this,void 0,void 0,(function*(){try{const t={method:"GET",headers:{}},i=yield Object(C.b)(()=>Object(n.a)(this,void 0,void 0,(function*(){const i=new URL(`${O.e.CMSListServiceUrl}${e}${v.a.ContentServiceUrlBase.search}`,""+v.a.ContentServiceUrlBase),a=yield fetch(i.toString(),t);if(a.ok)return a.json();S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed",`Invalid response from CMS. status: ${a.status}, statusText: ${a.statusText}, url: ${a.url}`))})),"getProviderName");if(!i)return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","Invalid response.json(), cmsId: "+e));const a=i;return a?a.displayName:void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed","Failed to parse JSON response, cmsId: "+e))}catch(t){return void S.a.sendAppErrorEvent(Object(s.a)(r.je,"Get CMSAd content failed",`Error while fetching Provider name  ${t}, cmsId: ${e}`))}}))}}var j=i("Bwzq");const A={rating:3,likes:4,price:6,salePrice:7,installmentPrice:500,priceDrop:501,freeShipping:502,viewed:503,sold:504,specialOffer:505,eliteBadge:506,condition:507,localInventory:508,curbsidePickup:509,review:510,discount:600};var w,I=i("SHdd"),T=i("zfSW"),R=i("hOj1"),P=i("I6Lx"),M=i("y+Kz"),k=i("tWvP"),E=i("ypwz"),F=i("s9+9"),x=i("4wjP");!function(e){e.AR="AR",e.GA="GA",e.VI="VI",e.EDGECHRNTP="edgechrntp",e.EDGECHRDHP="edgechrdhp",e.MSNEWS="msnews",e.FirstParty="firstparty",e.VerticalLandingPage="vlp",e.WINVLP="winvlp",e.WINAR="winar",e.WINGA="winga",e.WINVI="winvi",e.WEBCOMPAR="webcompar",e.WEBCOMPGA="webcompga",e.WEBCOMPVI="webcompvi"}(w||(w={}));var D=i("uNSK"),N=i("KRKw"),L=i("3Amp"),U=i("GqIT");let W,B=!1;const H=new Promise(e=>{W=e});function $(){return Object(n.a)(this,void 0,void 0,(function*(){switch(yield function(){return Object(n.a)(this,void 0,void 0,(function*(){B||(L.a.cookieConsentStatus.registerObserver(e=>{W()}),B=!0);const e=U.a.getInstance().rootReducer.connector(F.a.SharedState),t=e&&e.getCurrentState(),i=t&&t.cookieConsentStatus;return i!==N.b.Unknown?i:(yield H,e.getCurrentState().cookieConsentStatus)}))}()){case N.b.Required:return!0;case N.b.NotRequired:return!1;default:return}}))}class q{updateMsaOptOutCookie(e){if(!this.getMsaOptoutCookieData()&&e&&e.optout){const t=!0===e.optout.msaOptOut?"1":"0";this.setMsaOptoutCookie(t)}}getMsaOptoutCookieData(){const e=Object(R.a)(O.f.MSAOptOut);return e&&e.length>0?e:null}setMsaOptoutCookie(e){e&&e.length>0&&Object(k.a)(O.f.MSAOptOut,e,1,null,"/")}getBrowserOptoutStatus(){const e=Object(R.a)(O.f.BrowserOptOut);return!(!e||"1"!==e)}setUserOptOutSettings(){const e=this.getBrowserOptoutStatus(),t=this.getMsaOptoutCookieData(),i=!(!t||"1"!==t),a=(e||i).toString().toLowerCase();let n="";e&&(n="b|"),i&&(n+="m");const s=O.b.UserOptOut+":"+a+";"+O.b.UserOptOutOptions+":"+n;if(document.head.attributes["data-info"]){const e=document.head.attributes["data-info"].value.split(";");e.find(e=>e.indexOf(O.b.UserOptOut)>-1)?e.find(e=>e.indexOf(O.b.UserOptOut)>-1)!==O.b.UserOptOut+":"+a&&(document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(O.b.UserOptOut+":false",O.b.UserOptOut+":"+a).replace(O.b.UserOptOut+":true",O.b.UserOptOut+":"+a)):document.head.attributes["data-info"].value=document.head.attributes["data-info"].value+";"+O.b.UserOptOut+":"+a,e.find(e=>e.indexOf(O.b.UserOptOutOptions)>-1)?e.find(e=>e.indexOf(O.b.UserOptOutOptions)>-1)!==O.b.UserOptOutOptions+":"+n&&(e.includes(O.b.UserOptOutOptions+":")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(O.b.UserOptOutOptions+":",O.b.UserOptOutOptions+":"+n):e.includes(O.b.UserOptOutOptions+":b|")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(O.b.UserOptOutOptions+":b|",O.b.UserOptOutOptions+":"+n):e.includes(O.b.UserOptOutOptions+":b|m")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(O.b.UserOptOutOptions+":b|m",O.b.UserOptOutOptions+":"+n):e.includes(O.b.UserOptOutOptions+":m")&&(document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(O.b.UserOptOutOptions+":m",O.b.UserOptOutOptions+":"+n))):document.head.attributes["data-info"].value=document.head.attributes["data-info"].value+";"+O.b.UserOptOutOptions+":"+n}else document.head.setAttribute("data-info",s)}}var V=i("HhTf"),G=i("loKy"),z=i("w0HK"),_=i("C4R5");let Q=!0;let J=0;Object(T.e)({id:I.b.SAMWebWorkerCalled,type:"subscription"},e=>{e.id===I.b.SAMWebWorkerCalled&&e.fetched&&J++,J>=I.a.DuplicatedCalledTimes&&S.a.sendAppErrorEvent(Object(s.a)(r.D,"duplicate calling SAMRTB Ajax","times: "+J))});class K{constructor(){this.riverNativeAdCount=0,this.reservedRiverNativeAdCount=0,this.dualWideRiverNativeAdCount=0,this.halfRiverNativeAdCount=0,this.beaconService=new g.a,this.cookieService=new q,this.ecasession=O.b.Ecasession;const e=U.a.getInstance().rootReducer;if(v.a.AppType===E.a.EdgeChromium){const t=e.connector(F.a.ChromiumPageSettings);t&&(this.anaheimPageLayout=t.getCurrentState().currentLayout)}const t=e.connector(F.a.SharedState);t&&t.getCurrentState().useHistory?Object(_.a)().addSwitchListener(this.onPivotSwitch.bind(this),G.a.Monetization):Object(z.a)().addSwitchListener(this.onPivotSwitch.bind(this),G.a.Monetization)}get sourceUrl(){if(this._sourceUrl)return this._sourceUrl;this._sourceUrl=v.a.HostPage.originalUrl;const e=v.a.CurrentRequestTargetScope.pageType,t=v.a.HostPage.verticalKey;if(e&&t){const i=e.toLowerCase();(i.indexOf(x.b.DHP)>-1||i.indexOf(x.b.NTP)>-1)&&(this._sourceUrl="https://"+v.a.HostPage.hostName+"/"+t+"/"+e)}return this._sourceUrl}get pageType(){if(this._pageType)return this._pageType;const e=v.a.CurrentRequestTargetScope.pageType,t=v.a.CurrentRequestTargetScope.ocid;return this._pageType=e,v.a.AppType===E.a.EdgeChromium?this._pageType=w.EDGECHRNTP:v.a.AppType===E.a.Views&&("article"===e?this._pageType=this.isWindowsViewsPage(t)?w.WINAR:w.WEBCOMPAR:"gallery"===e?this._pageType=this.isWindowsViewsPage(t)?w.WINGA:w.WEBCOMPGA:"video"===e&&(this._pageType=this.isWindowsViewsPage(t)?w.WINVI:w.WEBCOMPVI)),this._pageType}fetchSAMAds(e,t=!1){return Object(n.a)(this,void 0,void 0,(function*(){if(!e||!e.placements||e.placements.length<1)return void S.a.sendAppErrorEvent(Object(s.a)(r.me,"Invalid request to fetch native ads","No placements found in the request"));const{anaheimColLayout:i}=e,a=e.pageType||this.pageType;if(!a)return void S.a.sendAppErrorEvent(Object(s.a)(r.me,"Invalid request to fetch native ads","No page type found"));const n=this.getImpressionId(),d=this.cookieService.getBrowserOptoutStatus(),l=yield $(),h=this.getMuid(e.adid),u=this.riverNativeAdCount,p=this.reservedRiverNativeAdCount,g=this.dualWideRiverNativeAdCount,b=this.halfRiverNativeAdCount;!l&&t&&(this.ecasession=Object(R.a)(O.f.TaboolaSessionCookieName)||this.ecasession);const m=!(!P.b.ClientSettings||!P.b.ClientSettings.deviceFormFactor||P.b.ClientSettings.deviceFormFactor!==V.a.Phone),f=this.isNotMyFeed(),C={locale:e.locale,rid:n,partnerId:v.a.CurrentRequestTargetScope.pageType,content:{sourceUrl:this.sourceUrl,pageType:a,previousReservedRiverNativeAdCount:p,previousRiverDualWideNativeAdCount:g,previousRiverHalfNativeAdCount:b,previousRiverNativeAdCount:u,verticalName:v.a.HostPage.verticalKey,anaheimPageLayout:this.anaheimPageLayout,anaheimColLayout:i,isXfeed:f,audienceMode:v.a&&v.a.CurrentRequestTargetScope&&v.a.CurrentRequestTargetScope.audienceMode},user:{muid:h,browserOptOut:d,isAdblock:!1},placements:this.getPlacements(e,a),extensions:this.getExtensions(this.lastResponseMetadata,this.ecasession),isCookieWallPresent:l,isPeregrine:!0,device:{isMobile:m}},y=JSON.stringify(C),A=new URL(O.b.SamEndpoint);return new Promise(t=>{try{if((t=>e.enableAuctionInWebWorker&&Q&&!P.b.IsPrerender&&!f&&t)(J===I.a.FirstCalledTimes||Object(D.b)()))Object(T.b)({id:I.b.AuctionPrefetch},O.j.Timeout).then(e=>{const i=e.payload;t(i?this.processAdResponse(i):void 0)});else{Q&&e.enableAuctionInWebWorker&&(J++,Object(T.d)({id:I.b.SAMMainThreadCalled,type:"data",payload:{initialSAMRequestTimes:J}}));const i=new XMLHttpRequest;i.open(O.j.Method,A.href,!0),i.withCredentials=!0,i.timeout=O.j.Timeout,i.setRequestHeader(O.j.ContentTypeKey,O.j.ContentType),i.setRequestHeader(O.j.FlightIdKey,P.b.CurrentFlights),i.setRequestHeader(O.j.CacheControlKey,O.j.CacheControl),h&&i.setRequestHeader(O.j.ClientIdKey,h),a===w.GA?i.setRequestHeader(O.j.AuthCookieNameKey,O.f.AnonCookieName):Object(R.a)(O.f.AppAnonCookieExist)&&i.setRequestHeader(O.j.AuthCookieNameKey,M.e),i.onload=()=>{t(this.processAdResponse(i))},i.ontimeout=()=>{S.a.sendAppErrorEvent(Object(s.a)(r.oe,"Timeout calling SAMRTB Ajax",`pageType: ${a}, status: ${i.status}, StatusText: ${i.statusText}`)),t(void 0)},i.onerror=()=>{S.a.sendAppErrorEvent(Object(s.a)(r.ne,"Error calling SAMRTB Ajax",`pageType: ${a}, status: ${i.status}, StatusText: ${i.statusText}`)),t(void 0)},i.send(y)}const i=!0===P.b.IsPrerender?performance.now()-Object(o.j)(c.d):performance.now();Object(o.q)(j.a.TimeToRequestAd,i)}catch(e){Object(s.c)(e,r.pe,"Failed to get response from SAMRTB call","pageType: "+a),t(void 0)}finally{Q=!1}})}))}generateSourceUrl(){const e=v.a.CurrentRequestTargetScope.pageType;let t=v.a.HostPage.originalUrl;const i=v.a.HostPage.verticalKey;if(e&&i){const a=e.toLowerCase();(a.indexOf(x.b.DHP)>-1||a.indexOf(x.b.NTP)>-1)&&(t="https://"+v.a.HostPage.hostName+"/"+i+"/"+e)}return t}processAdResponse(e){if(200!==e.status)return 204===e.status?void S.a.sendAppErrorEvent(Object(s.a)(r.oe,"No content received from SAMRTB Ajax",`Status: ${e.status}, StatusText: ${e.statusText}`)):void S.a.sendAppErrorEvent(Object(s.a)(r.ne,"Invalid response from SAMRTB Ajax",`Status: ${e.status}, StatusText: ${e.statusText}`));try{const t=JSON.parse(e.response);if(!t)return void S.a.sendAppErrorEvent(Object(s.a)(r.qe,"Invalid json response from SAMRTB",`Status: ${e.status}, Invalid json: ${e.response}`));const i=t.metaData;return this.processMetaData(i),this.beaconService.fireRequestLevelBeacons(i.requestLevelBeaconUrls),t}catch(t){return void Object(s.c)(t,r.pe,"Failed to process SAMRTB response",`Status: ${e.status}, json: ${e.response}`)}}getPlacements(e,t){const i=[];return e.placements.forEach(e=>{if(e.region&&e.indices&&e.indices.length){const{indices:a,img:n}=e,s=t==w.EDGECHRNTP&&O.h[e.region]||e.region,r=n?{region:s,indices:a,img:n}:{region:s,indices:a};i.push(r);const o=e.region.toLocaleLowerCase();o===O.b.RiverRegion?this.riverNativeAdCount+=e.indices.length:o===O.b.ReservedRiver?this.reservedRiverNativeAdCount+=e.indices.length:o===O.b.RiverDoubleWide?this.dualWideRiverNativeAdCount+=e.indices.length:o!==O.b.RiverHalf&&o!==O.b.RiverHalfTextOnly||(this.halfRiverNativeAdCount+=e.indices.length)}}),i}processMetaData(e){const t=e&&e.taboola&&e.taboola.sessionId;!this.isCookieWallPresent&&t&&Object(k.a)(O.f.TaboolaSessionCookieName,t,.042,O.f.CookieDomain,"/"),this.lastResponseMetadata=this.mergeMetadata(this.lastResponseMetadata,e),this.cookieService.updateMsaOptOutCookie(e)}mergeMetadata(e,t){return e?t?(t.taboola=this.mergePartnerMetadata(e.taboola,t.taboola),t):e:t}mergePartnerMetadata(e,t){return t=t||{},e&&e.sessionId&&!t.sessionId&&(t.sessionId=e.sessionId),t}getImpressionId(){return this.lastResponseMetadata&&this.lastResponseMetadata.pageViewId?this.lastResponseMetadata.pageViewId:S.a.getRequestId()}clearPreviousInfo(){var e;this.riverNativeAdCount=0,this.reservedRiverNativeAdCount=0,this.dualWideRiverNativeAdCount=0,this.halfRiverNativeAdCount=0,(null===(e=this.lastResponseMetadata)||void 0===e?void 0:e.pageViewId)&&delete this.lastResponseMetadata.pageViewId}getExtensions(e,t){const i={taboola:(e=e||{taboola:{}}).taboola};return i.taboola.sessionId||(i.taboola.sessionId=t),i}getMuid(e){return this.isCookieWallPresent?null:e||Object(R.b)()}onPivotSwitch(e){if(!e.oldSelection)return;const t=e.newSelection.pivotId;t&&t.toLowerCase()!==O.i.EditInterestPivotId&&(this.pivotId=t)}isNotMyFeed(){return!!this.pivotId&&this.pivotId.toLowerCase()!==O.i.MyFeedPivotId&&this.pivotId.toLowerCase()!==O.i.StripeMyFeedPivotId}isWindowsViewsPage(e){return!!e&&("windirect"===(e=e.toLowerCase())||e.startsWith("winp"))}}var Z=i("Crvi"),X=i("Tc2z"),Y=i("hV4J"),ee=i("hqLi"),te=i("SEb4"),ie=i("mEtE"),ae=i("3noN");function ne(e,t){return t.template.templateType=e,!0}function se(e,t){return t.template.templateType=Z.a.ZIndex,t.template.flipZIndex=!0,!0}function re(e,t){return ne(Z.a.RiverAnimatedImagery_9by16,t)}function oe(e,t){return ne(Z.a.RiverZIndex_9by16,t)}function ce(e,t){return t&&t.items&&1===t.items.length&&(e===Z.b._1by1?t.template.templateType=Z.a.InfopaneHorizontal_1by1:e===Z.b._4by3?t.template.templateType=Z.a.InfopaneHorizontal_4by3:e===Z.b._3by4?t.template.templateType=Z.a.InfopaneHorizontal_3by4:e===Z.b._9by16&&(t.template.templateType=Z.a.InfopaneHorizontal_9by16)),!0}function de(e,t){return t&&t.items&&1===t.items.length&&(e===Z.b._1by1?t.template.templateType=Z.a.InfopanePatternOverlay_1by1:e===Z.b._4by3&&(t.template.templateType=Z.a.InfopanePatternOverlay_4by3)),!0}function le(e,t,i){return e[Math.floor(Math.random()*e.length)](t,i)}function he(e,t,i){let a=0;Object(ae.a)(e,e=>{a+=e.weight});const n=Math.floor(Math.random()*a);let s=0;for(let a=0;a<e.length;++a)if(s+=e[a].weight,n<s)return e[a].template(t,i),!0;return!1}function ue(e,t){return t.template.templateType=Z.a.PatternOverlay,e===Z.b._16by9?t.template.landscapeOverlay=!0:e===Z.b._4by3&&(t.template.landscapeOverlay=!1),!0}const pe={riverSingleAdMultiImage:function(e,t){return t.slideshowProps={autoScroll:t.template.slideshowProps.autoScroll,maxImageCount:t.template.slideshowProps.maxImageCount},he([{template:()=>(t.template.templateType=Z.a.Slideshow,t.slideshowProps.autoScrollIntervalMs=t.template.slideshowProps.slideshowScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!0,!0),weight:100-Object(h.a)(t,"template.slideshowProps.psuedoVideoAllocation",80)},{template:()=>(t.template.templateType=Z.a.PseudoVideo,t.slideshowProps.autoScrollIntervalMs=t.template.slideshowProps.psuedoVideoScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!1,!0),weight:Object(h.a)(t,"template.slideshowProps.psuedoVideoAllocation",20)}],e,t)},riverMultiAds:ue},ge=[{template:ue,weight:1},{template:se,weight:1}],ve=[{ratio:Z.b._lowerBound,width:1,height:9999},{ratio:Z.b._1by191,width:1,height:1.91},{ratio:Z.b._9by16,width:9,height:16,riverSingleAdSingleImage:function(e,t){return le([re,oe],e,t)},infoPaneSingleImage:ce},{ratio:Z.b._3by4,width:3,height:4,riverSingleAdSingleImage:function(e,t){return ne(Z.a.RiverZIndex_3by4,t)},infoPaneSingleImage:ce},{ratio:Z.b._1by1,width:1,height:1,riverSingleAdSingleImage:se,riverSingleAdMultiImage:se,riverMultiAds:function(e,t){return ne(Z.a.AdCarousel,t)},infoPaneSingleImage:(e,t)=>le([ce,de],e,t)},{ratio:Z.b._4by3,width:4,height:3,riverSingleAdSingleImage:(e,t)=>he(ge,e,t),riverSingleAdMultiImage:(e,t)=>he(ge,e,t),riverMultiAds:(e,t)=>he(ge,e,t),infoPaneSingleImage:(e,t)=>le([ce,de],e,t)},Object.assign(Object.assign({ratio:Z.b._16by9,width:16,height:9},pe),{riverSingleAdSingleImage:ue}),Object.assign({ratio:Z.b._191by1,width:1.91,height:1},pe)];function be(e,t,i,a){const n=i?e.ext.originalImageWidth:e.originalImageWidth,s=i?e.ext.originalImageHeight:e.originalImageHeight,r=1*n/s,o=1*t.width/t.height,c={w:n,h:s};r>=o?c.w=Math.round(s*o):c.h=Math.round(n/o);const d={river:300,infopane:604};return c.w>d[a]&&(c.h=Math.round(c.h*d[a]/c.w),c.w=d[a]),function(e,t,i,a){const n=a?new URL(i.url):new URL(i.imageUrl);n.searchParams.set("h",e),n.searchParams.set("w",t),n.searchParams.set("c","4"),a?i.url=n.href:i.imageUrl=n.href}(c.h,c.w,e,i),c}function me(e){if(!e.items||0===e.items.length||!e.items[0].originalImageHeight||!e.items[0].originalImageWidth||"bing"!==e.providerId||"river"!==e.region&&"infopane"!==e.region)return!1;const t=function(e){const t=Number(e.originalImageHeight),i=Number(e.originalImageWidth);let a=1;for(;a<ve.length&&Math.ceil(i*ve[a].height)!==Math.ceil(t*ve[a].width);++a)if(!(Math.ceil(i*ve[a].height)>Math.ceil(t*ve[a].width))){if(1==a)break;const e=1*i/t;Math.abs(e-ve[a].width/ve[a].height)>=Math.abs(e-ve[a-1].width/ve[a-1].height)&&(a-=1);break}return a==ve.length&&(a-=1),ve[a]}(e.items[0]);let i,a=!1;return"infopane"===e.region?1==e.items.length&&(a=e.items[0].images&&e.items[0].images.length>1?t.infoPaneMultiImage&&t.infoPaneMultiImage(t.ratio,e):t.infoPaneSingleImage&&t.infoPaneSingleImage(t.ratio,e)):"river"===e.region&&(a=e.items.length>1?t.riverMultiAds&&t.riverMultiAds(t.ratio,e):e.items[0].images&&e.items[0].images.length>1?t.riverSingleAdMultiImage&&t.riverSingleAdMultiImage(t.ratio,e):t.riverSingleAdSingleImage&&t.riverSingleAdSingleImage(t.ratio,e)),a&&(e.items.forEach(a=>{const n=be(a,t,!1,e.region);i||(i=n),a.images&&Object(ae.a)(a.images,i=>{i.ext&&i.ext.originalImageWidth&&i.ext.originalImageHeight&&be(i,t,!0,e.region)})}),e.template.desiredHeight=i.h.toString(),e.template.desiredWidth=i.w.toString(),e.template.desiredRatio=t.ratio),a}class fe{}fe.concat=(e,t)=>`${e}.${t}`,fe.identity=e=>t=>fe.concat(e,t),fe.boolean=e=>t=>t?fe.concat(e,"1"):null;class Oe{constructor(){this._availableAssets="",this._displayedAssets=""}get availableAssets(){return this._availableAssets}get displayedAssets(){return this._displayedAssets}setAvailableAssets(e){e.items&&e.items[0]&&e.items[0].assets&&(this._availableAssets=Object(X.a)(Object.keys(e.items[0].assets),e=>A[e]).join("_"))}setDisplayedAssets(e){e.items&&e.items[0]&&e.items[0].assets&&(this._displayedAssets=Object(X.a)(Object.keys(e.items[0].assets),e=>A[e]).join("_"))}}const Ce={templateType:fe.identity("type"),animatedImage:fe.identity("ani"),flipZIndex:fe.boolean("fz"),landscapeOverlay:fe.boolean("lo")};class Se{constructor(){this.hasAnyInlineDecoration=e=>{if(e.items&&0!==e.items.length){if(e.items[0]&&e.items[0].assets){const t=e.items[0].assets;return!!(t.price||t.salePrice||t.installmentPrice||t.rating||t.review||t.priceDrop||t.viewed||t.freeShipping)}return!1}return!1}}updateTemplate(e,t={}){if(!e||"resriver"===e.region||"resinfopane"===e.region)return;this.decorationBeaconBuilder=new Oe,this.decorationBeaconBuilder.setAvailableAssets(e);const i=Object(Y.a)({},t,Z.c);let a=!1;t.templateSelection&&e.items&&e.items[0].originalImageHeight&&e.items[0].originalImageWidth&&(e.template=i,a=me(e)),a||(e.template=this.processConfig(e,i)),this.resetTempateTypeForInfopaneInMultiAds(e),this.filterAssetByFlight(e),this.updatePlacementImageSize(e),this.updateTemplateTypeForPriceDiscount(e),this.updateBeacon(e)}processConfig(e,t){const i=t;if(this.updateAllowedAssetsAndTemplateForInfopane(e,i),"river"!==e.region&&(i.templateType=Z.a.Default),this.updateSlideshowTemplateType(e,t,i),i.templateType===Z.a.PatternOverlay){"225"===this.getItemImageSize(e).height?i.landscapeOverlay=!1:i.templateType=Z.a.Default}return i.templateType===Z.a.Default&&e.items&&e.items.length>3&&i.adCarousel&&(i.templateType=Z.a.AdCarousel),this.updateTemplateInfoForBrandStory(e,i),i}updatePlacementImageSize(e){if(e.template.templateType===Z.a.PatternOverlay){const t=this.getItemImageSize(e);e.imageWidth=Object(h.a)(e,"imageWidth",t.width),e.imageHeight=Object(h.a)(e,"imageHeight",t.height)}}updateBeacon(e){if(!Object(ee.a)(e.beaconsJson)){const t=JSON.parse(e.beaconsJson);if(t&&Object(te.a)(t.trb)){let i=!1;t.trb=t.trb.map(t=>{if(t.includes("srtb.msn.com")){i=!0;const a=new URL(t);return b.a.appendSearchParam(a,"t",this.serializeTemplateConfig(e)),this.decorationBeaconBuilder.setDisplayedAssets(e),this.decorationBeaconBuilder.availableAssets&&b.a.appendSearchParam(a,"dec",this.decorationBeaconBuilder.availableAssets+"-"+this.decorationBeaconBuilder.displayedAssets),a.href}return t}),i&&(e.beaconsJson=JSON.stringify(t))}}}serializeTemplateConfig(e){return Object(l.a)(Ce,(t,i,a)=>{const n=Object(h.a)(e.template,a);if(n){const e=i(n);if(e)return""===t?e:`${t}_${e}`}return t},"")}updateSlideshowTemplateType(e,t,i){if(t.templateType!==Z.a.Default)return;e&&e.items&&e.items[0]&&e.items[0].images&&e.items[0].images.length>1&&(i.templateType=this.SlideshowTemplateType||this.getSlideshowTemplateType(t,i),e.slideshowProps=i.slideshowProps)}getSlideshowTemplateType(e,t){if(this.SlideshowTemplateType=Z.a.Default,e&&e.slideshowProps&&t.slideshowProps){const i=Math.floor(100*Math.random());e.slideshowProps.psuedoVideoAllocation&&e.slideshowProps.psuedoVideoAllocation>i?(this.SlideshowTemplateType=Z.a.PseudoVideo,t.slideshowProps.autoScrollIntervalMs=e.slideshowProps.psuedoVideoScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!1):(this.SlideshowTemplateType=Z.a.Slideshow,t.slideshowProps.autoScrollIntervalMs=e.slideshowProps.slideshowScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!0)}return this.SlideshowTemplateType}getItemImageSize(e){const t=Object(ie.a)(e.items);return Object(ee.a)(t)?{}:{width:""+Object(h.a)(t,"imageWidth"),height:""+Object(h.a)(t,"imageHeight")}}calculateDiscount(e){const t=e.price,i=e.salePrice;if(t&&i){const a=Number(t.replace(/[^0-9.-]+/g,"")),n=Number(i.replace(/[^0-9.-]+/g,""));e.discount=Math.floor((a-n)/a*100)}}filterAssetByFlight(e){if(e&&e.items&&e.items[0]&&e.items[0].assets){this.calculateDiscount(e.items[0].assets);const t=Object(l.a)(e.items[0].assets,(t,i,a)=>{var n;return Object(te.a)(null===(n=e.template)||void 0===n?void 0:n.allowedAssets)&&e.template.allowedAssets.includes(A[a])&&(t[a]=i),t},{});e.items[0].assets=t}}resetTempateTypeForInfopaneInMultiAds(e){"infopane"===e.region&&e.items&&e.items.length>1&&(e.template.templateType=Z.a.Default,e.template.animatedImage="")}isValidProviderNameForBrand(e){if(!(e&&e.items&&e.items[0]&&e.items[0].providerName))return!1;const t=e.items[0].providerName;return-1===t.indexOf("/")&&t.length<20}updateAllowedAssetsAndTemplateForInfopane(e,t){t.templateType!==Z.a.BrandStory&&t.templateType!==Z.a.BrandStoryNoDeco&&t.templateType!==Z.a.BrandStoryNoProgressiveDisplay&&t.templateType!==Z.a.HotspotSingle&&t.templateType!==Z.a.DiscountScribble&&t.templateType!==Z.a.ContentReveal&&t.templateType!==Z.a.Gamification||"infopane"===e.region&&(t.allowedAssets=void 0,t.templateType=Z.a.Default)}updateTemplateInfoForBrandStory(e,t){var i,a,n,s;t.templateType!==Z.a.BrandStory&&t.templateType!==Z.a.BrandStoryNoDeco&&t.templateType!==Z.a.BrandStoryNoProgressiveDisplay||((null===(a=null===(i=e.items)||void 0===i?void 0:i[0])||void 0===a?void 0:a.description)===(null===(s=null===(n=e.items)||void 0===n?void 0:n[0])||void 0===s?void 0:s.providerName)&&(e.items[0].description=null),this.isValidProviderNameForBrand(e)||(t.templateType=Z.a.Default,t.allowedAssets=void 0))}updateTemplateTypeForPriceDiscount(e){var t,i,a,n,s,r,o,c,d,l,h,u,p,g,v,b,m,f,O;const{Default:C,HotspotSingle:S,BrandStory:y,DiscountScribble:j,ContentReveal:A,Gamification:w}=Z.a;(null===(a=null===(i=null===(t=e.items)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||void 0===a?void 0:a.discount)>=(null===(n=e.template)||void 0===n?void 0:n.discountThreshold)||([S,j,w].includes(null===(s=e.template)||void 0===s?void 0:s.templateType)&&(e.template.templateType=C,e.template.allowedAssets=void 0,e.items[0].assets={}),(null===(r=e.template)||void 0===r?void 0:r.templateType)===A&&(null===(d=null===(c=null===(o=e.items)||void 0===o?void 0:o[0])||void 0===c?void 0:c.assets)||void 0===d||delete d.discount,(null===(h=null===(l=e.items)||void 0===l?void 0:l[0])||void 0===h?void 0:h.description)===(null===(p=null===(u=e.items)||void 0===u?void 0:u[0])||void 0===p?void 0:p.providerName)&&(e.items[0].description=null),(null===(v=null===(g=e.items)||void 0===g?void 0:g[0])||void 0===v?void 0:v.description)||this.hasAnyInlineDecoration(e)||(e.template.templateType=C,e.template.allowedAssets=void 0)),(null===(b=e.template)||void 0===b?void 0:b.templateType)===y&&(null===(O=null===(f=null===(m=e.items)||void 0===m?void 0:m[0])||void 0===f?void 0:f.assets)||void 0===O||delete O.discount))}}var ye=i("b169");const je=()=>{var e;const t=performance.getEntriesByName&&(null===(e=performance.getEntriesByName(O.b.SamEndpoint)[0])||void 0===e?void 0:e.duration);t?Object(o.q)(j.a.ApiDuration,t):Object(T.b)({id:I.b.AuctionAPIDuration}).then(({payload:e})=>{e&&Object(o.q)(j.a.ApiDuration,e)})};class Ae{constructor(){this.beaconService=new g.a,this.cmsService=new y,this.samService=new K,this.templateService=new Se,this.cmsNativeAdsItemsMap=new Map,this.cmsRetryCount=0,this.backfillIndex=0,this.cmsAdsCounter=0,this.callbackFnPlacementList=[],this.callbackList=[]}resetNativeAdService(){this.backfillIndex=0,this.cmsAdsCounter=0,this.callbackFnPlacementList.length=0,this.callbackList.length=0,this.samService.clearPreviousInfo()}fetchNativeAds(e){return Object(n.a)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(s.a)(r.ke,"Fetch NativeAd failed","No placements found in the request"));if(e.locale||(e.locale=P.b.Locale),!e.locale)return void S.a.sendAppErrorEvent(Object(s.a)(r.ke,"Fetch NativeAd failed",`No locale found, headData.Locale: ${P.b.Locale}, adRequest.locale: ${e.locale}`));const t=this.samService.fetchSAMAds(e),i=e.locale,a=O.c[i];if(!this.cmsItems){const e=yield this.cmsService.getCMSList(a,i);e&&(this.cmsItems=e.items)}const n=this.buildAdResponse(e),o=yield t;return this.updateAdResponse(n,this.cmsItems,a,o),n}))}updateAdResponse(e,t,i,a){const n=!t||0==t.length,d=!a||!a.placements||0==a.placements.length;if(n&&d)return void S.a.sendAppErrorEvent(Object(s.a)(r.le,"Fetch NativeAd failed",`Unable to retrieve backfill list id: ${i} and SAM response`));n&&S.a.sendAppErrorEvent(Object(s.a)(r.le,"Unable to retrieve backfill list","Backfill list id: "+i));const l=this.mapSAMPlacements(a);return e.pageViewId=a&&a.metaData&&a.metaData.pageViewId,e.placements.forEach(e=>{const i=e.region+e.regionIndex,a=l.get(i);if(a&&a.items&&a.items.length>0){a.items.forEach(t=>{const i={title:t.title,destinationUrl:t.url,imageUrl:t.imageUrl,providerName:t.sourceName,adChoiceIconUrl:t.adChoicesUrl,imageHeight:t.imageHeight,imageWidth:t.imageWidth,clickBeacons:t.clickBeacons,uniqueId:t.uniqueId,feedbackUrl:Object(p.a)(t.clickBeacons),verificationParameters:t.verificationParameters};e.items.push(i)}),e.privacyUrl=a.privacyUrl,e.adServedUrls=a.adServedUrls,e.jsTrackerUrls=a.jsTrackerUrls,e.visibilityUrls=a.visibilityUrls,e.beaconsJson=a.beaconsJson,e.bingTrackerUrls=a.bingTrackerUrls,e.geminiViewabilityDataJson=a.geminiViewabilityDataJson,this.beaconService.fireAdServedTrackingCall(a.beaconsJson);const t=!0===P.b.IsPrerender?performance.now()-Object(o.j)(c.d):performance.now();Object(o.q)(j.a.TimeToServeAd,t),je()}else if(n)S.a.sendAppErrorEvent(Object(s.a)(r.G,"Unable to backfill invalid sam placement","Placement key: "+i));else{const i=this.backfillIndex++%t.length,a=t[i],n={title:a.title,destinationUrl:a.url,imageUrl:this.updateImageUrl(e,a.imageUrl),providerName:a.provider?a.provider.name:""};e.items.push(n),e.privacyUrl=a.privacyUrl}}),e}fetchSamAds(e,t=!1,i){return Object(n.a)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(s.a)(r.ke,"Fetch NativeAd failed","No placements found in the request"));if(e.locale||(e.locale=P.b.Locale),!e.locale)return void S.a.sendAppErrorEvent(Object(s.a)(r.ke,"Fetch NativeAd failed",`No locale found, headData.Locale: ${P.b.Locale}, adRequest.locale: ${e.locale}`));i&&i.length>0&&this.callbackList.push(...i),this.locale=e.locale;const a=this.samService.fetchSAMAds(e,t);return{placeHolderResponse:this.buildAdResponse(e),samResponse:yield a}}))}fetchCmsAds(e,t,i){return Object(n.a)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(s.a)(r.ke,"Fetch NativeAd failed","No placements found in the request"));const a=P.b.Locale;if(!this.cmsNativeAdsItemsMap.has(t)){const e=yield this.cmsService.getCMSList(t,a);e&&e.id&&e.items&&this.cmsNativeAdsItemsMap.set(t,e.items)}const n=this.buildAdResponse(e),o=this.cmsNativeAdsItemsMap.has(t)?this.cmsNativeAdsItemsMap.get(t):[];for(const e of n.placements){const t=i.shift();let n,s;if(t){let e=parseInt(t,10);if(e)e=Math.max(e-1,0),e=e<o.length?e:e%o.length,n=o[e];else{if(!this.cmsNativeAdsItemsMap.has(t)){const e=yield this.cmsService.getCMSList(t,a);e&&e.id&&e.items&&this.cmsNativeAdsItemsMap.set(t,e.items)}const e=this.cmsNativeAdsItemsMap.has(t)?this.cmsNativeAdsItemsMap.get(t):[];n=Object(d.a)(e)[0],n||(n=o[this.cmsAdsCounter%o.length])}}else n=o[this.cmsAdsCounter%o.length];n&&(s={title:n.title,destinationUrl:n.url,imageUrl:this.updateImageUrl(e,n.imageUrl),providerName:n.provider?n.provider.name:""},e.items.push(s),e.privacyUrl=n.privacyUrl),this.cmsAdsCounter++}return n}))}updateSamAdResponse(e,t,i){const a=this.cmsItems,n=this.mapSAMPlacements(t),s=!a||0==a.length;return e.pageViewId=t&&t.metaData&&t.metaData.pageViewId,e.placements.forEach(e=>{const t=e.region+e.regionIndex,r=n.get(t);if(r&&r.items&&r.items.length>0){r.items.forEach(t=>{const i={title:t.title,description:t.description,destinationUrl:t.url,providerName:t.sourceName,adChoiceIconUrl:t.adChoicesUrl,imageUrl:t.imageUrl,imageHeight:t.imageHeight,imageWidth:t.imageWidth,images:t.images,clickBeacons:t.clickBeacons,uniqueId:t.uniqueId,beaconsJson:t.beaconsJson,feedbackUrl:Object(p.a)(t.clickBeacons),originalImageWidth:t.originalImageWidth,originalImageHeight:t.originalImageHeight,verificationParameters:t.verificationParameters};this.updateAssetVideoField(i,t.assets),this.updateAssetDataFields(i,t.assets),e.items.push(i)});const t=Object(ye.a)(e,0);e.videoViewabilityData=t?t.ViewabilityProps:null,e.privacyUrl=r.privacyUrl,e.adServedUrls=r.adServedUrls,e.jsTrackerUrls=r.jsTrackerUrls,e.visibilityUrls=r.visibilityUrls,e.beaconsJson=r.beaconsJson,e.bingTrackerUrls=r.bingTrackerUrls,e.geminiViewabilityDataJson=r.geminiViewabilityDataJson,e.providerId=r.providerId;const a=!0===P.b.IsPrerender?performance.now()-Object(o.j)(c.d):performance.now();Object(o.q)(j.a.TimeToServeAd,a),je(),this.templateService.updateTemplate(e,i)}else if(s)this.handleCmsStandyPlacement(e);else{const t=this.backfillIndex++%a.length,i=a[t],n={title:i.title,destinationUrl:i.url,imageUrl:this.updateImageUrl(e,i.imageUrl),providerName:i.provider?i.provider.name:""};e.items.push(n),e.privacyUrl=i.privacyUrl,e.isBackfill=!0}}),e}handleCmsStandyPlacement(e){if(this.cmsItems){const t=this.cmsItems;for(const i of this.callbackFnPlacementList){const a=t[this.backfillIndex++%t.length],n={title:a.title,destinationUrl:a.url,imageUrl:this.updateImageUrl(e,a.imageUrl),providerName:a.provider?a.provider.name:""};i.items.push(n),i.privacyUrl=a.privacyUrl,i.isBackfill=!0}this.callbackList.forEach(e=>{e(this)}),this.callbackList=[],this.callbackFnPlacementList=[]}else e&&this.callbackFnPlacementList.push(e)}loadCmsBackFillList(){const e=this.locale?this.locale:P.b.Locale,t=O.c[e];t&&!this.cmsItems&&this.cmsService.getCMSList(t,e).then(e=>{e?(this.cmsItems=e.items,this.handleCmsStandyPlacement()):++this.cmsRetryCount<10&&this.loadCmsBackFillList()})}mapSAMPlacements(e){const t=new Map;return e&&e.placements&&e.placements.forEach(e=>{e.region&&e.index&&t.set(e.region+e.index,e)}),t}buildAdResponse(e){const t=[];e.placements.forEach(e=>{e.region&&e.indices&&e.indices.length&&e.indices.forEach(i=>{const a={region:e.region,regionIndex:i,imageHeight:e.img&&e.img.h&&e.img.h.toString(),imageWidth:e.img&&e.img.w&&e.img.w.toString(),items:[]};t.push(a)})});return{placements:t,adLabelText:Object(p.b)(e.locale),isGreyAdsLabelEnabled:O.g.includes(e.locale),privacyUrl:O.b.PrivacyUrl}}updateImageUrl(e,t){return e&&e.imageWidth&&e.imageHeight&&t?t.replace("w=624","w="+e.imageWidth).replace("h=350","h="+e.imageHeight):t}updateAssetDataFields(e,t){const i=Object(l.a)(t,(e,t)=>{const i=Object(h.a)(t,"data.type"),a=Object(u.a)(A,e=>e===i);return a&&(e[a]=Object(h.a)(t,"data.value")),e},{});e.assets=i}updateAssetVideoField(e,t){t&&t.length>0&&t.forEach(t=>{const i=Object(h.a)(t,"video.vasttag");i&&(e.video=i)})}getAdTagStyleByLocale(e){const t=null!=e?e:P.b.Locale;return{adLabelText:Object(p.b)(t),isGreyAdsLabelEnabled:O.g.includes(t)}}}let we;function Ie(){return we||(we=new Ae),we.resetNativeAdService(),we}},ejtM:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var a=i("cxul"),n=i("LJMo"),s=i("HxRh"),r=i("K1Uj"),o=i("u5KZ"),c=i("W+kI"),d=i("C/Vb");const l={[a.b.contentCard]:(e,t,i)=>{var a;e.isProviderInFooter=i.config.isProviderInFooter,(null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.socialBarWC)&&Object(d.a)(i.config.childExperienceReferencesWC.socialBarWC)},[a.b.infopaneCard]:(e,t,i)=>{var a,n,s;e.activeIndicator=!1,e.autoRotateIntervalMs=1e3*(null===(a=null==t?void 0:t.wpoMetadata)||void 0===a?void 0:a.infopaneRemainingSlidesTransitionSpeedInSeconds)||i.config.autoRotateIntervalMs||5e3,e.firstAutoRotateIntervalMs=1e3*(null===(n=null==t?void 0:t.wpoMetadata)||void 0===n?void 0:n.infopaneFirstSlideTransitionSpeedInSeconds)||i.config.firstAutoRotateIntervalMs,e.disableAutoRotate=i.config.disableAutoRotate,Object(c.a)().get("vpFreeze")&&(e.disableAutoRotate=!0),i.config.useColorfulInfopane||delete e.configOptions.useArticleCardTemplate,(null===(s=i.config.childExperienceReferencesWC)||void 0===s?void 0:s.socialBarWC)&&Object(d.a)(i.config.childExperienceReferencesWC.socialBarWC)},[a.b.moneyCard]:(e,t,i)=>{i.money&&(e.cardStateData=i.money.moneyStateManager.getMoneyState(),e.handleNavClick=i.handleMoneyNavClick,e.handleAddToWatchlist=i.money.handleAddToWatchlist,e.refreshMoneyCardData=i.handleRefreshMoneyData,e.cardLayout=r.a.full)},[a.b.comicsCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.selectCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.editorsPickCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.dailyFixGamesCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.localNewsCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.topicFeedCarouselCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.selectCarousel)},[a.b.shoppingCarouselCard]:(e,t,i)=>{var a,s;t.type===n.a.ShoppingCard&&(null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.shoppingCard)&&(e.configOptions=i.config.childExperienceReferencesWC.shoppingCard),t.type===n.a.ShoppingCarousel&&(null===(s=i.config.childExperienceReferencesWC)||void 0===s?void 0:s.shoppingCarousel)&&(e.configOptions=i.config.childExperienceReferencesWC.shoppingCarousel)},[a.b.weatherCard]:(e,t,i)=>{var a;(null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.weatherCard)&&(Object(d.a)(i.config.childExperienceReferencesWC.weatherCard),e.configOptions=i.config.childExperienceReferencesWC.weatherCard)},[a.b.coldStartCard]:(e,t,i,a)=>{var n;const r=i.config.expectedColdStartPosition;r&&r>=0&&a+1!==r&&o.a.sendAppErrorEvent(s.zb);const c=null===(n=i.config.childExperienceReferencesWC)||void 0===n?void 0:n.coldStartRiverCard;c&&Object(d.a)(c),e.upsellGetStartedClickHandler=i.config.upsellLaunchesInline?void 0:i.initializeColdStartExperience},[a.b.newsSegmentCarousel]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.newsSegmentCarousel)},[a.b.horoscopeAnswerCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.horoscopeCard)},[a.b.electionsCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.electionsCard)},[a.b.bingVideoCarousel]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.bingVideoCarousel)},[a.b.denseCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.denseCard)},[a.b.recommendedSearchCarousel]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.recommendedSearchCarousel)},[a.b.trendingNowCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.trendingNowWC)},[a.b.moneyInfoCardWC]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.moneyInfoCardWC)},[a.b.healthCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.bingHealthCard)},[a.b.onThisDayCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.onThisDayCard)},[a.b.lotteryCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.lotteryCard)},[a.b.qnaCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.qnaCard)},[a.b.recipesCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.recipesCard)},[a.b.esportsCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.esportsCard)},[a.b.trafficCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.trafficCard)},[a.b.travelDestinationCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.travelDestination)},[a.b.sportsCard]:(e,t,i)=>{var a;(null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.sportsCard)&&(Object(d.a)(i.config.childExperienceReferencesWC.sportsCard),e.configOptions=i.config)},[a.b.sportsOlympicCard]:(e,t,i)=>{var a;h(e,null===(a=i.config.childExperienceReferencesWC)||void 0===a?void 0:a.sportsOlympicCard)}},h=(e,t)=>{t?(Object(d.a)(t),e.configOptions=t):e.configOptions=null}},eupA:function(e,t,i){"use strict";var a=i("JFdr");t.a=function(e,t){var i=-1,n=e.length,s=n-1;for(t=void 0===t?n:t;++i<t;){var r=Object(a.a)(i,s),o=e[r];e[r]=e[i],e[i]=o}return e.length=t,e}},hV4J:function(e,t,i){"use strict";var a=i("2JSu"),n=i("HVAe"),s=i("p6Gq"),r=i("MyC+"),o=Object.prototype,c=o.hasOwnProperty,d=Object(a.a)((function(e,t){e=Object(e);var i=-1,a=t.length,d=a>2?t[2]:void 0;for(d&&Object(s.a)(t[0],t[1],d)&&(a=1);++i<a;)for(var l=t[i],h=Object(r.a)(l),u=-1,p=h.length;++u<p;){var g=h[u],v=e[g];(void 0===v||Object(n.a)(v,o[g])&&!c.call(e,g))&&(e[g]=l[g])}return e}));t.a=d},hme2:function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));var a=i("D57K"),n=i("OkDC"),s=i("tMmC"),r=i("HxRh"),o=i("ypwz"),c=i("tERu"),d=i("rvYQ"),l=i("msIb"),h=i("6ADy"),u=i("/+Un"),p=i("KETb");class g{constructor(e){this.fetchImpl=e,this.actionsEndpoint="./Graph/Actions",this.defaultOcid="Peregrine"}sendPostActionRequest(e,t=this.defaultOcid,i=!0){return Object(a.a)(this,void 0,void 0,(function*(){const n=JSON.stringify(e),s={method:"POST",body:n,headers:yield l.a.getOneServiceHeaders()};(yield Object(u.e)())&&(s.credentials="include");const r=Object(h.c)(this.actionsEndpoint);(yield l.a.getCommonParams2(t,i)).forEach(e=>e.value&&r.searchParams.set(e.key,e.value));return yield Object(p.b)(()=>Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(r.href,s);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for Post request: ${r.href} with params ${JSON.stringify(s)}`;throw new Error(t)}return e})),"postAction"+n)}))}sendDeleteActionRequest(e,t=this.defaultOcid,i=!0){return Object(a.a)(this,void 0,void 0,(function*(){const n=yield l.a.getBaseRequestData("DELETE");(yield Object(u.e)())&&(n.credentials="include");let s="";const r=Object.keys(e),o=r.length;for(let t=0;t<o;t++)s+=`${r[t]} eq '${e[r[t]]}'`,t!=o-1&&o>1&&(s+=" and ");const c={key:"$filter",value:s},d=Object(h.c)(this.actionsEndpoint);[c,...yield l.a.getCommonParams2(t,i)].forEach(e=>e.value&&d.searchParams.set(e.key,e.value));return yield Object(p.b)(()=>Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(d.href,n);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for Delete request: ${d.href} with params: ${JSON.stringify(n)}`;throw new Error(t)}return e})),"deleteAction"+s)}))}}var v=i("u5KZ"),b=i("ac9z"),m=i("HDSB");class f extends class{constructor(e){this.fetchImpl=e,this.ocid="feeds",this.freServiceEndpoint="news/fre",this.userEndpoint="./msn/user",this.addPageInfoToOcid=!0,this.actionsClient=new g(e),d.a.AppType!==o.a.NewsAndInterests&&d.a.AppType!==o.a.WindowsNewsPlus||(this.addPageInfoToOcid=!1,this.ocid="winp2")}getFreArtifacts(){return Object(a.a)(this,void 0,void 0,(function*(){const e=Object(h.c)(this.freServiceEndpoint);e.searchParams.set("bypass_trigger","true");return[...(yield Object(u.d)())===c.c.SignedIn?l.a.getOneServiceParamsWithAuth(Object(d.b)().UserId,this.ocid,this.addPageInfoToOcid):l.a.getOneServiceParamsWithoutAuth(Object(d.b)().UserId,this.ocid,this.addPageInfoToOcid),{key:b.a,value:Date.now().toString()}].forEach(t=>{t.value&&e.searchParams.set(t.key,t.value)}),this.getFreArtifactsWithUrl(e.href)}))}getFreArtifactsWithUrl(e){return Object(a.a)(this,void 0,void 0,(function*(){if(!e||"-1"===e)return null;const t={method:n.d.Get,credentials:"include",headers:yield l.a.getOneServiceHeaders()};try{const i=yield Object(p.b)(()=>Object(a.a)(this,void 0,void 0,(function*(){return yield this.fetchImpl(e,t)})),"getFreArtifacts");if(!i.ok)throw Error("[FreServiceClient.getFreArtifacts] Failed with response: "+JSON.stringify(i));const n=i.headers&&i.headers.get("ddd-tmpl");return v.a.addOrUpdateTmplString(n),i.json()}catch(e){throw s.a.logError(e.message),e}}))}setFreArtifactForUser(e,t){return Object(a.a)(this,void 0,void 0,(function*(){if(e&&t){const i={method:t,credentials:"include",headers:yield l.a.getOneServiceHeaders()};Object(h.c)(this.freServiceEndpoint);let n=0;try{if(n=(yield Object(p.b)(()=>Object(a.a)(this,void 0,void 0,(function*(){return yield this.fetchImpl(e,i)})),"setFreArtifact")).status,n>=400){const e=`OneService returned error response. Status: ${n} for done action`;throw new Error(e)}}catch(e){return s.a.logError(e.message),n}return n}return v.a.sendAppErrorEvent(Object.assign(Object.assign({},r.Gg),{message:`Any of the required parameters was not properly set by the caller. callbackUrl: ${e} method: ${t}.`})),0}))}updateArtifactInActionsEndpoint(e,t){return Object(a.a)(this,void 0,void 0,(function*(){let i;n.a[e.type]&&(i=Object.assign({},n.a[e.type])),i.targetId=e.id;try{t?yield this.actionsClient.sendPostActionRequest(i,this.ocid,this.addPageInfoToOcid):yield this.actionsClient.sendDeleteActionRequest(i,this.ocid,this.addPageInfoToOcid),Object(b.d)()}catch(i){v.a.sendAppErrorEvent(Object.assign(Object.assign({},r.ee),{message:"Fre Actions call failed",pb:Object.assign(Object.assign({},r.ee.pb),{customMessage:`artifact: ${JSON.stringify(e)} following: ${t} error message: ${i}`})}))}}))}setDoneFreState(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.setFreState(JSON.stringify({stage:n.b}),r.Gb)}))}setMaybeLaterFreState(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.setFreState(JSON.stringify({dismiss_timestamp:new Date(Date.now()).toJSON()}),r.ge)}))}setFreState(e,t){return Object(a.a)(this,void 0,void 0,(function*(){const i={method:"POST",body:JSON.stringify({freMultiStepState:e}),headers:yield l.a.getOneServiceHeaders()};(yield Object(u.d)())===c.c.SignedIn&&(i.credentials="include");const n=Object(h.c)(this.userEndpoint);(yield l.a.getCommonParams2(this.ocid,this.addPageInfoToOcid)).forEach(e=>e.value&&n.searchParams.set(e.key,e.value));try{yield Object(p.b)(()=>Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(n.href,i);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for call to set user state`;throw new Error(t)}return e.json()})),"sendFreDoneAction")}catch(i){v.a.sendAppErrorEvent(Object.assign(Object.assign({},t),{message:"Service call to set fre state failed",pb:Object.assign(Object.assign({},t.pb),{customMessage:`state: ${e} error: ${i}`})}))}}))}}{constructor(e){let t;t=e||(Object(m.a)()?window.fetch.bind(window):fetch),super(t)}}let O;const C=e=>O||(O=new f(e),O)},mEtE:function(e,t,i){"use strict";t.a=function(e){return e&&e.length?e[0]:void 0}},mOQN:function(e,t,i){"use strict";var a=i("oKML"),n=i("FoV5");t.a=function(e){return null==e?[]:Object(a.a)(e,Object(n.a)(e))}},mXQk:function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return l}));const a={ColdStart:"ColdStart",UpsellGetStartedButton:"GetStarted"},n="cold-start-close",s="cold-start-confirm",r="cold-start-selection-done",o={Article:{width:148,height:108},Provider:{width:64,height:64},Topic:{width:200,height:200},FollowCard:{width:82,height:82}},c=10,d="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtCmK3.img",l="coldStartUpsell"},oKML:function(e,t,i){"use strict";var a=i("mr4r");t.a=function(e,t){return Object(a.a)(t,(function(t){return e[t]}))}},pMIE:function(e,t,i){"use strict";var a=i("/XsO"),n=i("eupA");var s=function(e){return Object(n.a)(Object(a.a)(e))},r=i("mOQN");var o=function(e){return Object(n.a)(Object(r.a)(e))},c=i("SEb4");t.a=function(e){return(Object(c.a)(e)?s:o)(e)}},rGfm:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var a=i("G82u");class n{}n.refreshRiver=new a.a("RiverRefresh"),n.repaintRiver=new a.a("RiverRepaint"),n.riverRefreshed=new a.a("RiverRefreshed"),n.riverQueryUpdated=new a.a("RiverQueryUpdated"),n.riverLocationUpdated=new a.a("RiverLocationUpdated")},roS3:function(e,t,i){"use strict";var a=i("B1m9");t.a=function(e,t){return t="function"==typeof t?t:void 0,Object(a.a)(e,5,t)}},zZnt:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));i("Cj5D"),i("dTwT");const a={bingShoppingVisible:!0,moneyVisible:!0,sportsVisible:!0,weatherVisible:!0,horoscopeVisible:!0,onThisDayVisible:!0,electionsVisible:!0,esportsVisible:!0,lotteryVisible:!0,qnaVisible:!0,recipesVisible:!0},n="localCardState"}}]);